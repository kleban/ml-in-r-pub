<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Математичне моделювання в R - 7&nbsp; Дерева рішень. Класифікація. Депозити</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./037-supervised-learning-neural-network-classification.html" rel="next">
<link href="./035-supervised-learning-logistic-regression.html" rel="prev">
<link href="./img/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Дерева рішень. Класифікація. Депозити</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Математичне моделювання в R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kleban/ml-in-r-book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Про курс</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-intro.html" class="sidebar-item-text sidebar-link">ТЕМА 1. ВСТУП ДО КУРСУ</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./020-feature-engeneering.html" class="sidebar-item-text sidebar-link">ТЕМА 2. КОНСТРУЮВАННЯ ОЗНАК</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./023-feature-engeneering-woe-binning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Woe Binning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./030-supervised-learning.html" class="sidebar-item-text sidebar-link">ТЕМА 3. НАВЧАННЯ "З УЧИТЕЛЕМ"</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./031-supervised-learning-linear-regression-1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Лінійна регресія. Престиж професій</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./032-supervised-learning-linear-regression-2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Лінійна регресія. Прокат велосипедів</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./033-supervised-learning-desicion-trees-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Дерева рішень. Регресія. Баланс кредитної карти</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./034-supervised-learning-neutal-networks-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Нейронні мережі. Регресія. Вартість житла</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./035-supervised-learning-logistic-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Логістична регресія. Класифікація. Титанік</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./036-supervised-learning-desicion-trees-classification.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Дерева рішень. Класифікація. Депозити</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./037-supervised-learning-neural-network-classification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Нейронні мережі. Deep Learning. Класифікація. Кредитний скоринг</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./040-unsupervised-learning.html" class="sidebar-item-text sidebar-link">ТЕМА 4. НАВЧАННЯ "БЕЗ УЧИТЕЛЯ"</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./041-unsupervised-learning-clustering-kmeans.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Метод k-середніх</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link active" data-scroll-target="#dataset-description"><span class="toc-section-number">7.1</span>  Dataset description</a></li>
  <li><a href="#data-load-and-preview" id="toc-data-load-and-preview" class="nav-link" data-scroll-target="#data-load-and-preview"><span class="toc-section-number">7.2</span>  Data load and preview</a></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization"><span class="toc-section-number">7.3</span>  Data visualization</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing"><span class="toc-section-number">7.4</span>  Data preprocessing</a></li>
  <li><a href="#traintest-split" id="toc-traintest-split" class="nav-link" data-scroll-target="#traintest-split"><span class="toc-section-number">7.5</span>  Train/test split</a></li>
  <li><a href="#decision-trees-with-rpart" id="toc-decision-trees-with-rpart" class="nav-link" data-scroll-target="#decision-trees-with-rpart"><span class="toc-section-number">7.6</span>  Decision trees with <code>rpart()</code></a></li>
  <li><a href="#desicion-trees-with-partykit" id="toc-desicion-trees-with-partykit" class="nav-link" data-scroll-target="#desicion-trees-with-partykit"><span class="toc-section-number">7.7</span>  Desicion trees with PartyKit</a></li>
  <li><a href="#desision-tree-with-c50" id="toc-desision-tree-with-c50" class="nav-link" data-scroll-target="#desision-tree-with-c50"><span class="toc-section-number">7.8</span>  Desision Tree with c50</a></li>
  <li><a href="#randomforest" id="toc-randomforest" class="nav-link" data-scroll-target="#randomforest"><span class="toc-section-number">7.9</span>  RandomForest</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="toc-section-number">7.10</span>  xgBoost</a></li>
  <li><a href="#lightgbm" id="toc-lightgbm" class="nav-link" data-scroll-target="#lightgbm"><span class="toc-section-number">7.11</span>  lightgbm</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Дерева рішень. Класифікація. Депозити</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Курс: “Математичне моделювання в R”</p>
<hr>
<p>У даній частині навчального процесу потрібно побудувати математичні моделі класифікації клієнтів на основі алгоритму дерева рішень та перевірити їх на тестовій вибірці.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("C50")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("xgboost")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("scorecard")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("lightgbm")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("Matrix") </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("scorecard") </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="dataset-description" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="dataset-description"><span class="header-section-number">7.1</span> Dataset description</h2>
<p><strong>Abstract</strong></p>
<p>The data is related with direct marketing campaigns (phone calls) of a Portuguese banking institution. The classification goal is to predict if the client will subscribe a term deposit (variable y).</p>
<p><strong>Data Set Information:</strong></p>
<p>The data is related with direct marketing campaigns of a Portuguese banking institution. The marketing campaigns were based on phone calls. Often, more than one contact to the same client was required, in order to access if the product (bank term deposit) would be (‘yes’) or not (‘no’) subscribed.</p>
<p>There are four datasets: 1. bank-additional-full.csv with all examples (41188) and 20 inputs, ordered by date (from May 2008 to November 2010), very close to the data analyzed in [Moro et al., 2014] 2. bank-additional.csv with 10% of the examples (4119), randomly selected from 1), and 20 inputs. 3. bank-full.csv with all examples and 17 inputs, ordered by date (older version of this dataset with less inputs). 4. bank.csv with 10% of the examples and 17 inputs, randomly selected from 3 (older version of this dataset with less inputs).</p>
<p>The smallest datasets are provided to test more computationally demanding machine learning algorithms (e.g., SVM).</p>
<p>The classification goal is to predict if the client will subscribe (<code>yes/no</code>) a term deposit (variable <code>y</code>).</p>
<p><strong>Attribute Information</strong></p>
<p><strong>Input variables: bank client data:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>No</th>
<th>Title</th>
<th>Description</th>
<th>Data Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><code>age</code></td>
<td></td>
<td>numeric</td>
<td></td>
</tr>
<tr class="even">
<td>2</td>
<td><code>job</code></td>
<td>type of job</td>
<td>categorical</td>
<td>‘admin.’, ‘blue-collar’, ‘entrepreneur’, ‘housemaid’, ‘management’, ‘retired’, ‘self-employed’, ‘services’, ‘student’, ‘technician’, ‘unemployed’, ‘unknown’</td>
</tr>
<tr class="odd">
<td>3</td>
<td><code>marital</code></td>
<td>marital status</td>
<td>categorical</td>
<td>‘divorced’,‘married’,‘single’,‘unknown’; note: ‘divorced’ means divorced or widowed</td>
</tr>
<tr class="even">
<td>4</td>
<td><code>education</code></td>
<td></td>
<td>categorical</td>
<td>‘basic.4y’,‘basic.6y’,‘basic.9y’,‘high.school’,‘illiterate’,‘professional.course’,‘university.degree’,‘unknown’</td>
</tr>
<tr class="odd">
<td>5</td>
<td><code>default</code></td>
<td>has credit in default?</td>
<td>categorical</td>
<td>‘no’,‘yes’,‘unknown’</td>
</tr>
<tr class="even">
<td>6</td>
<td><code>housing</code></td>
<td>has housing loan?</td>
<td>categorical</td>
<td>‘no’,‘yes’,‘unknown’</td>
</tr>
<tr class="odd">
<td>7</td>
<td><code>loan</code></td>
<td>has personal loan?</td>
<td>categorical</td>
<td>‘no’,‘yes’,‘unknown’</td>
</tr>
</tbody>
</table>
<p><strong>Input variables: related with the last contact of the current campaign:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>No</th>
<th>Title</th>
<th>Description</th>
<th>Data Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>8</td>
<td>contact</td>
<td>contact communication type</td>
<td>categorical</td>
<td>‘cellular’,‘telephone’</td>
</tr>
<tr class="even">
<td>9</td>
<td>month</td>
<td>last contact month of year</td>
<td>categorical</td>
<td>‘jan’, ‘feb’, ‘mar’, …, ‘nov’, ‘dec’</td>
</tr>
<tr class="odd">
<td>10</td>
<td>day_of_week</td>
<td>last contact day of the week</td>
<td>categorical</td>
<td>‘mon’,‘tue’,‘wed’,‘thu’,‘fri’</td>
</tr>
<tr class="even">
<td>11</td>
<td>duration</td>
<td>last contact duration, in seconds</td>
<td>numeric</td>
<td></td>
</tr>
</tbody>
</table>
<p><code>duration</code> - <strong><em>Important note: this attribute highly affects the output target (e.g., if duration=0 then y=‘no’). Yet, the duration is not known before a call is performed. Also, after the end of the call y is obviously known. Thus, this input should only be included for benchmark purposes and should be discarded if the intention is to have a realistic predictive model.</em></strong></p>
<p><strong>Input variables: other attributes:</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>No</th>
<th>Title</th>
<th>Description</th>
<th>Data Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>12</td>
<td><code>campaign</code></td>
<td>number of contacts performed during this campaign and for this client</td>
<td>numeric</td>
<td>includes last contact</td>
</tr>
<tr class="even">
<td>13</td>
<td><code>pdays</code></td>
<td>number of days that passed by after the client was last contacted from a previous campaign</td>
<td>numeric</td>
<td>999 mean client was not previously contacted</td>
</tr>
<tr class="odd">
<td>14</td>
<td><code>previous</code></td>
<td>number of contacts performed before this campaign and for this client</td>
<td>numeric</td>
<td></td>
</tr>
<tr class="even">
<td>15</td>
<td><code>poutcome</code></td>
<td>outcome of the previous marketing campaign</td>
<td>categorical</td>
<td>‘failure’,‘nonexistent’,‘success’</td>
</tr>
</tbody>
</table>
<p><strong>Input variables: social and economic context attributes</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>No</th>
<th>Title</th>
<th>Description</th>
<th>Data Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>16</td>
<td><code>emp.var.rate</code></td>
<td>employment variation rate - quarterly indicator</td>
<td>numeric</td>
<td></td>
</tr>
<tr class="even">
<td>17</td>
<td><code>cons.price.idx</code></td>
<td>consumer price index - monthly indicator</td>
<td>numeric</td>
<td></td>
</tr>
<tr class="odd">
<td>18</td>
<td><code>cons.conf.idx</code></td>
<td>consumer confidence index - monthly indicator</td>
<td></td>
<td>numeric</td>
</tr>
<tr class="even">
<td>19</td>
<td><code>euribor3m</code></td>
<td>euribor 3 month rate - daily indicator</td>
<td>numeric</td>
<td></td>
</tr>
<tr class="odd">
<td>20</td>
<td><code>nr.employed</code></td>
<td>number of employees - quarterly indicator</td>
<td>numeric</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Output variable (desired target):</strong></p>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>No</th>
<th>Title</th>
<th>Description</th>
<th>Data Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>21</td>
<td><code>y</code></td>
<td>has the client subscribed a term deposit?</td>
<td>binary</td>
<td>‘yes’,‘no’</td>
</tr>
</tbody>
</table>
<p>Source: https://archive.ics.uci.edu/ml/datasets/bank+marketing</p>
<hr>
</section>
<section id="data-load-and-preview" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="data-load-and-preview"><span class="header-section-number">7.2</span> Data load and preview</h2>
<p>Для початку завантажимо дані у змінну <code>data</code>:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/kleban/r-course-eng/main/data/banking.csv"</span>, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">" "</span>, <span class="st">"NA"</span>, <span class="st">"NULL"</span>), <span class="co"># fix missing as NA if present</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>) <span class="co"># set strings as factor, we need this for some algorithms</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#use + unknown with na.strings if you want to play with missing</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- read.csv("data/banking.csv", na.strings = c("", " ", "NA", "NULL", "unknown"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Переглянемо структуру вибірки даних з <code>str()</code>:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   11162 obs. of  17 variables:
 $ age      : int  59 56 41 55 54 42 56 60 37 28 ...
 $ job      : Factor w/ 12 levels "admin.","blue-collar",..: 1 1 10 8 1 5 5 6 10 8 ...
 $ marital  : Factor w/ 3 levels "divorced","married",..: 2 2 2 2 2 3 2 1 2 3 ...
 $ education: Factor w/ 4 levels "primary","secondary",..: 2 2 2 2 3 3 3 2 2 2 ...
 $ default  : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
 $ balance  : int  2343 45 1270 2476 184 0 830 545 1 5090 ...
 $ housing  : Factor w/ 2 levels "no","yes": 2 1 2 2 1 2 2 2 2 2 ...
 $ loan     : Factor w/ 2 levels "no","yes": 1 1 1 1 1 2 2 1 1 1 ...
 $ contact  : Factor w/ 3 levels "cellular","telephone",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ day      : int  5 5 5 5 5 5 6 6 6 6 ...
 $ month    : Factor w/ 12 levels "apr","aug","dec",..: 9 9 9 9 9 9 9 9 9 9 ...
 $ duration : int  1042 1467 1389 579 673 562 1201 1030 608 1297 ...
 $ campaign : int  1 1 1 1 2 2 1 1 1 3 ...
 $ pdays    : int  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
 $ previous : int  0 0 0 0 0 0 0 0 0 0 ...
 $ poutcome : Factor w/ 4 levels "failure","other",..: 4 4 4 4 4 4 4 4 4 4 ...
 $ deposit  : Factor w/ 2 levels "no","yes": 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
</div>
<p>Переглянемо вигляд перших рядків даних з <code>head()</code>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 17</caption>
<thead>
    <tr><th></th><th scope="col">age</th><th scope="col">job</th><th scope="col">marital</th><th scope="col">education</th><th scope="col">default</th><th scope="col">balance</th><th scope="col">housing</th><th scope="col">loan</th><th scope="col">contact</th><th scope="col">day</th><th scope="col">month</th><th scope="col">duration</th><th scope="col">campaign</th><th scope="col">pdays</th><th scope="col">previous</th><th scope="col">poutcome</th><th scope="col">deposit</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>59</td><td>admin.    </td><td>married</td><td>secondary</td><td>no</td><td>2343</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1042</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
    <tr><th scope="row">2</th><td>56</td><td>admin.    </td><td>married</td><td>secondary</td><td>no</td><td>  45</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1467</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
    <tr><th scope="row">3</th><td>41</td><td>technician</td><td>married</td><td>secondary</td><td>no</td><td>1270</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1389</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
    <tr><th scope="row">4</th><td>55</td><td>services  </td><td>married</td><td>secondary</td><td>no</td><td>2476</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td> 579</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
    <tr><th scope="row">5</th><td>54</td><td>admin.    </td><td>married</td><td>tertiary </td><td>no</td><td> 184</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td> 673</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
    <tr><th scope="row">6</th><td>42</td><td>management</td><td>single </td><td>tertiary </td><td>no</td><td>   0</td><td>yes</td><td>yes</td><td>unknown</td><td>5</td><td>may</td><td> 562</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>yes</td></tr>
</tbody>
</table>
</div>
</div>
<p>Описова статистика факторів:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>      age                 job           marital         education   
 Min.   :18.00   management :2566   divorced:1293   primary  :1500  
 1st Qu.:32.00   blue-collar:1944   married :6351   secondary:5476  
 Median :39.00   technician :1823   single  :3518   tertiary :3689  
 Mean   :41.23   admin.     :1334                   unknown  : 497  
 3rd Qu.:49.00   services   : 923                                   
 Max.   :95.00   retired    : 778                                   
                 (Other)    :1794                                   
 default        balance      housing     loan           contact    
 no :10994   Min.   :-6847   no :5881   no :9702   cellular :8042  
 yes:  168   1st Qu.:  122   yes:5281   yes:1460   telephone: 774  
             Median :  550                         unknown  :2346  
             Mean   : 1529                                         
             3rd Qu.: 1708                                         
             Max.   :81204                                         
                                                                   
      day            month         duration       campaign     
 Min.   : 1.00   may    :2824   Min.   :   2   Min.   : 1.000  
 1st Qu.: 8.00   aug    :1519   1st Qu.: 138   1st Qu.: 1.000  
 Median :15.00   jul    :1514   Median : 255   Median : 2.000  
 Mean   :15.66   jun    :1222   Mean   : 372   Mean   : 2.508  
 3rd Qu.:22.00   nov    : 943   3rd Qu.: 496   3rd Qu.: 3.000  
 Max.   :31.00   apr    : 923   Max.   :3881   Max.   :63.000  
                 (Other):2217                                  
     pdays           previous          poutcome    deposit   
 Min.   : -1.00   Min.   : 0.0000   failure:1228   no :5873  
 1st Qu.: -1.00   1st Qu.: 0.0000   other  : 537   yes:5289  
 Median : -1.00   Median : 0.0000   success:1071             
 Mean   : 51.33   Mean   : 0.8326   unknown:8326             
 3rd Qu.: 20.75   3rd Qu.: 1.0000                            
 Max.   :854.00   Max.   :58.0000                            
                                                             </code></pre>
</div>
</div>
<p>Перевіримо вибірку на наявність пропусків:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(mice))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(data) <span class="co"># OK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> /\     /\
{  `---'  }
{  O   O  }
==&gt;  V &lt;==  No need for mice. This data set is completely observed.
 \  \|/  /
  `-----'
</code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A matrix: 2 × 18 of type dbl</caption>
<thead>
    <tr><th></th><th scope="col">age</th><th scope="col">job</th><th scope="col">marital</th><th scope="col">education</th><th scope="col">default</th><th scope="col">balance</th><th scope="col">housing</th><th scope="col">loan</th><th scope="col">contact</th><th scope="col">day</th><th scope="col">month</th><th scope="col">duration</th><th scope="col">campaign</th><th scope="col">pdays</th><th scope="col">previous</th><th scope="col">poutcome</th><th scope="col">deposit</th><th scope="col"></th></tr>
</thead>
<tbody>
    <tr><th scope="row">11162</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td></tr>
    <tr><th scope="row"></th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-7-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anyNA</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
FALSE
</div>
</div>
<hr>
</section>
<section id="data-visualization" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="data-visualization"><span class="header-section-number">7.3</span> Data visualization</h2>
<p><strong>Вік клієнта (age):</strong></p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(age)) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Робота клієнта (job):</strong></p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(job)) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> job)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>job, data<span class="sc">$</span>deposit)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># more loyal to deposits are management, retired, student, unemployed ))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
              | data$deposit 
     data$job |        no |       yes | Row Total | 
--------------|-----------|-----------|-----------|
       admin. |       703 |       631 |      1334 | 
              |     0.002 |     0.002 |           | 
              |     0.527 |     0.473 |     0.120 | 
              |     0.120 |     0.119 |           | 
              |     0.063 |     0.057 |           | 
--------------|-----------|-----------|-----------|
  blue-collar |      1236 |       708 |      1944 | 
              |    44.415 |    49.320 |           | 
              |     0.636 |     0.364 |     0.174 | 
              |     0.210 |     0.134 |           | 
              |     0.111 |     0.063 |           | 
--------------|-----------|-----------|-----------|
 entrepreneur |       205 |       123 |       328 | 
              |     6.090 |     6.762 |           | 
              |     0.625 |     0.375 |     0.029 | 
              |     0.035 |     0.023 |           | 
              |     0.018 |     0.011 |           | 
--------------|-----------|-----------|-----------|
    housemaid |       165 |       109 |       274 | 
              |     3.010 |     3.343 |           | 
              |     0.602 |     0.398 |     0.025 | 
              |     0.028 |     0.021 |           | 
              |     0.015 |     0.010 |           | 
--------------|-----------|-----------|-----------|
   management |      1265 |      1301 |      2566 | 
              |     5.367 |     5.960 |           | 
              |     0.493 |     0.507 |     0.230 | 
              |     0.215 |     0.246 |           | 
              |     0.113 |     0.117 |           | 
--------------|-----------|-----------|-----------|
      retired |       262 |       516 |       778 | 
              |    53.042 |    58.899 |           | 
              |     0.337 |     0.663 |     0.070 | 
              |     0.045 |     0.098 |           | 
              |     0.023 |     0.046 |           | 
--------------|-----------|-----------|-----------|
self-employed |       218 |       187 |       405 | 
              |     0.113 |     0.125 |           | 
              |     0.538 |     0.462 |     0.036 | 
              |     0.037 |     0.035 |           | 
              |     0.020 |     0.017 |           | 
--------------|-----------|-----------|-----------|
     services |       554 |       369 |       923 | 
              |     9.621 |    10.683 |           | 
              |     0.600 |     0.400 |     0.083 | 
              |     0.094 |     0.070 |           | 
              |     0.050 |     0.033 |           | 
--------------|-----------|-----------|-----------|
      student |        91 |       269 |       360 | 
              |    51.136 |    56.782 |           | 
              |     0.253 |     0.747 |     0.032 | 
              |     0.015 |     0.051 |           | 
              |     0.008 |     0.024 |           | 
--------------|-----------|-----------|-----------|
   technician |       983 |       840 |      1823 | 
              |     0.591 |     0.656 |           | 
              |     0.539 |     0.461 |     0.163 | 
              |     0.167 |     0.159 |           | 
              |     0.088 |     0.075 |           | 
--------------|-----------|-----------|-----------|
   unemployed |       155 |       202 |       357 | 
              |     5.741 |     6.375 |           | 
              |     0.434 |     0.566 |     0.032 | 
              |     0.026 |     0.038 |           | 
              |     0.014 |     0.018 |           | 
--------------|-----------|-----------|-----------|
      unknown |        36 |        34 |        70 | 
              |     0.019 |     0.021 |           | 
              |     0.514 |     0.486 |     0.006 | 
              |     0.006 |     0.006 |           | 
              |     0.003 |     0.003 |           | 
--------------|-----------|-----------|-----------|
 Column Total |      5873 |      5289 |     11162 | 
              |     0.526 |     0.474 |           | 
--------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Сімейний статус (marital):</strong></p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(marital)) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> marital)) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>marital, data<span class="sc">$</span>deposit)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># married are not very loyal to deposits</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># but singles is more loyal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
data$marital |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
    divorced |       671 |       622 |      1293 | 
             |     0.128 |     0.142 |           | 
             |     0.519 |     0.481 |     0.116 | 
             |     0.114 |     0.118 |           | 
             |     0.060 |     0.056 |           | 
-------------|-----------|-----------|-----------|
     married |      3596 |      2755 |      6351 | 
             |    19.361 |    21.499 |           | 
             |     0.566 |     0.434 |     0.569 | 
             |     0.612 |     0.521 |           | 
             |     0.322 |     0.247 |           | 
-------------|-----------|-----------|-----------|
      single |      1606 |      1912 |      3518 | 
             |    32.436 |    36.018 |           | 
             |     0.457 |     0.543 |     0.315 | 
             |     0.273 |     0.362 |           | 
             |     0.144 |     0.171 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Освіта (education):</strong></p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(education)) <span class="sc">+</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> education)) <span class="sc">+</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>education, data<span class="sc">$</span>deposit)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># people with tertiary education is more loyal than other groups</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
               | data$deposit 
data$education |        no |       yes | Row Total | 
---------------|-----------|-----------|-----------|
       primary |       909 |       591 |      1500 | 
               |    18.172 |    20.179 |           | 
               |     0.606 |     0.394 |     0.134 | 
               |     0.155 |     0.112 |           | 
               |     0.081 |     0.053 |           | 
---------------|-----------|-----------|-----------|
     secondary |      3026 |      2450 |      5476 | 
               |     7.272 |     8.075 |           | 
               |     0.553 |     0.447 |     0.491 | 
               |     0.515 |     0.463 |           | 
               |     0.271 |     0.219 |           | 
---------------|-----------|-----------|-----------|
      tertiary |      1693 |      1996 |      3689 | 
               |    31.688 |    35.187 |           | 
               |     0.459 |     0.541 |     0.330 | 
               |     0.288 |     0.377 |           | 
               |     0.152 |     0.179 |           | 
---------------|-----------|-----------|-----------|
       unknown |       245 |       252 |       497 | 
               |     1.041 |     1.156 |           | 
               |     0.493 |     0.507 |     0.045 | 
               |     0.042 |     0.048 |           | 
               |     0.022 |     0.023 |           | 
---------------|-----------|-----------|-----------|
  Column Total |      5873 |      5289 |     11162 | 
               |     0.526 |     0.474 |           | 
---------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Дефолт (default):</strong></p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(default)) <span class="sc">+</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> default)) <span class="sc">+</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>default, data<span class="sc">$</span>deposit)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># defaults not very loyal to deposits, but why? ))))))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
data$default |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
          no |      5757 |      5237 |     10994 | 
             |     0.132 |     0.146 |           | 
             |     0.524 |     0.476 |     0.985 | 
             |     0.980 |     0.990 |           | 
             |     0.516 |     0.469 |           | 
-------------|-----------|-----------|-----------|
         yes |       116 |        52 |       168 | 
             |     8.621 |     9.573 |           | 
             |     0.690 |     0.310 |     0.015 | 
             |     0.020 |     0.010 |           | 
             |     0.010 |     0.005 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Баланс (balance):</strong></p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(balance)) <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># looks like balance data has outliers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Наявність кредиту на житло (housing):</strong></p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(housing)) <span class="sc">+</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> housing)) <span class="sc">+</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>housing, data<span class="sc">$</span>deposit)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># people without housing load logicaly more often can do deposits</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
data$housing |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
          no |      2527 |      3354 |      5881 | 
             |   104.023 |   115.509 |           | 
             |     0.430 |     0.570 |     0.527 | 
             |     0.430 |     0.634 |           | 
             |     0.226 |     0.300 |           | 
-------------|-----------|-----------|-----------|
         yes |      3346 |      1935 |      5281 | 
             |   115.842 |   128.633 |           | 
             |     0.634 |     0.366 |     0.473 | 
             |     0.570 |     0.366 |           | 
             |     0.300 |     0.173 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Наявність позики (loan):</strong></p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(loan)) <span class="sc">+</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> loan)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>loan, data<span class="sc">$</span>deposit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
   data$loan |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
          no |      4897 |      4805 |      9702 | 
             |     8.459 |     9.393 |           | 
             |     0.505 |     0.495 |     0.869 | 
             |     0.834 |     0.908 |           | 
             |     0.439 |     0.430 |           | 
-------------|-----------|-----------|-----------|
         yes |       976 |       484 |      1460 | 
             |    56.214 |    62.421 |           | 
             |     0.668 |     0.332 |     0.131 | 
             |     0.166 |     0.092 |           | 
             |     0.087 |     0.043 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong># Тип комунікації (contact):</strong></p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(contact)) <span class="sc">+</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> contact)) <span class="sc">+</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>contact, data<span class="sc">$</span>deposit)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cellular communication channel looks like the best way to increase deposits count</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># people with cellular devices has more money? </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
data$contact |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
    cellular |      3673 |      4369 |      8042 | 
             |    73.685 |    81.821 |           | 
             |     0.457 |     0.543 |     0.720 | 
             |     0.625 |     0.826 |           | 
             |     0.329 |     0.391 |           | 
-------------|-----------|-----------|-----------|
   telephone |       384 |       390 |       774 | 
             |     1.327 |     1.474 |           | 
             |     0.496 |     0.504 |     0.069 | 
             |     0.065 |     0.074 |           | 
             |     0.034 |     0.035 |           | 
-------------|-----------|-----------|-----------|
     unknown |      1816 |       530 |      2346 | 
             |   274.060 |   304.321 |           | 
             |     0.774 |     0.226 |     0.210 | 
             |     0.309 |     0.100 |           | 
             |     0.163 |     0.047 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>День місяця (day):</strong></p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(day)) <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">25</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Місяць (month):</strong></p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(month)) <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> month)) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># So, lets replace our month with ordered factor for correct visualization</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"jan"</span>,<span class="st">"feb"</span>,<span class="st">"mar"</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"apr"</span>,<span class="st">"may"</span>,<span class="st">"jun"</span>,<span class="st">"jul"</span>,<span class="st">"aug"</span>,<span class="st">"sep"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"oct"</span>,<span class="st">"nov"</span>,<span class="st">"dec"</span>),<span class="at">ordered=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(month)) <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> month)) <span class="sc">+</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>month, data<span class="sc">$</span>deposit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
             | data$deposit 
  data$month |        no |       yes | Row Total | 
-------------|-----------|-----------|-----------|
         jan |       202 |       142 |       344 | 
             |     2.437 |     2.706 |           | 
             |     0.587 |     0.413 |     0.031 | 
             |     0.034 |     0.027 |           | 
             |     0.018 |     0.013 |           | 
-------------|-----------|-----------|-----------|
         feb |       335 |       441 |       776 | 
             |    13.159 |    14.612 |           | 
             |     0.432 |     0.568 |     0.070 | 
             |     0.057 |     0.083 |           | 
             |     0.030 |     0.040 |           | 
-------------|-----------|-----------|-----------|
         mar |        28 |       248 |       276 | 
             |    94.619 |   105.067 |           | 
             |     0.101 |     0.899 |     0.025 | 
             |     0.005 |     0.047 |           | 
             |     0.003 |     0.022 |           | 
-------------|-----------|-----------|-----------|
         apr |       346 |       577 |       923 | 
             |    40.155 |    44.588 |           | 
             |     0.375 |     0.625 |     0.083 | 
             |     0.059 |     0.109 |           | 
             |     0.031 |     0.052 |           | 
-------------|-----------|-----------|-----------|
         may |      1899 |       925 |      2824 | 
             |   114.862 |   127.545 |           | 
             |     0.672 |     0.328 |     0.253 | 
             |     0.323 |     0.175 |           | 
             |     0.170 |     0.083 |           | 
-------------|-----------|-----------|-----------|
         jun |       676 |       546 |      1222 | 
             |     1.697 |     1.884 |           | 
             |     0.553 |     0.447 |     0.109 | 
             |     0.115 |     0.103 |           | 
             |     0.061 |     0.049 |           | 
-------------|-----------|-----------|-----------|
         jul |       887 |       627 |      1514 | 
             |    10.257 |    11.390 |           | 
             |     0.586 |     0.414 |     0.136 | 
             |     0.151 |     0.119 |           | 
             |     0.079 |     0.056 |           | 
-------------|-----------|-----------|-----------|
         aug |       831 |       688 |      1519 | 
             |     1.262 |     1.402 |           | 
             |     0.547 |     0.453 |     0.136 | 
             |     0.141 |     0.130 |           | 
             |     0.074 |     0.062 |           | 
-------------|-----------|-----------|-----------|
         sep |        50 |       269 |       319 | 
             |    82.740 |    91.876 |           | 
             |     0.157 |     0.843 |     0.029 | 
             |     0.009 |     0.051 |           | 
             |     0.004 |     0.024 |           | 
-------------|-----------|-----------|-----------|
         oct |        69 |       323 |       392 | 
             |    91.338 |   101.423 |           | 
             |     0.176 |     0.824 |     0.035 | 
             |     0.012 |     0.061 |           | 
             |     0.006 |     0.029 |           | 
-------------|-----------|-----------|-----------|
         nov |       540 |       403 |       943 | 
             |     3.872 |     4.300 |           | 
             |     0.573 |     0.427 |     0.084 | 
             |     0.092 |     0.076 |           | 
             |     0.048 |     0.036 |           | 
-------------|-----------|-----------|-----------|
         dec |        10 |       100 |       110 | 
             |    39.605 |    43.979 |           | 
             |     0.091 |     0.909 |     0.010 | 
             |     0.002 |     0.019 |           | 
             |     0.001 |     0.009 |           | 
-------------|-----------|-----------|-----------|
Column Total |      5873 |      5289 |     11162 | 
             |     0.526 |     0.474 |           | 
-------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Тривалість останнього контакту (duration):</strong></p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(duration)) <span class="sc">+</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Кількість контактів протягом поточної кампанії (campaign):</strong></p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(campaign)) <span class="sc">+</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Кількість днів від попередньої акції (pday):</strong></p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(pdays)) <span class="sc">+</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Кількість контактів до початку поточної кампанії (previous):</strong></p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(previous)) <span class="sc">+</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">50</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Результат попередньої кампанії (poutcome):</strong></p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(poutcome)) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> poutcome)) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>poutcome, data<span class="sc">$</span>deposit)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># people with previous success status also loyal for new propositions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
              | data$deposit 
data$poutcome |        no |       yes | Row Total | 
--------------|-----------|-----------|-----------|
      failure |       610 |       618 |      1228 | 
              |     2.020 |     2.243 |           | 
              |     0.497 |     0.503 |     0.110 | 
              |     0.104 |     0.117 |           | 
              |     0.055 |     0.055 |           | 
--------------|-----------|-----------|-----------|
        other |       230 |       307 |       537 | 
              |     9.773 |    10.852 |           | 
              |     0.428 |     0.572 |     0.048 | 
              |     0.039 |     0.058 |           | 
              |     0.021 |     0.028 |           | 
--------------|-----------|-----------|-----------|
      success |        93 |       978 |      1071 | 
              |   392.866 |   436.245 |           | 
              |     0.087 |     0.913 |     0.096 | 
              |     0.016 |     0.185 |           | 
              |     0.008 |     0.088 |           | 
--------------|-----------|-----------|-----------|
      unknown |      4940 |      3386 |      8326 | 
              |    71.378 |    79.259 |           | 
              |     0.593 |     0.407 |     0.746 | 
              |     0.841 |     0.640 |           | 
              |     0.443 |     0.303 |           | 
--------------|-----------|-----------|-----------|
 Column Total |      5873 |      5289 |     11162 | 
              |     0.526 |     0.474 |           | 
--------------|-----------|-----------|-----------|

 </code></pre>
</div>
</div>
<p><strong>Результат укладання або відсутність укладання договору (deposit):</strong></p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(deposit)) <span class="sc">+</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> deposit)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(data<span class="sc">$</span>deposit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  11162 

 
          |        no |       yes | 
          |-----------|-----------|
          |      5873 |      5289 | 
          |     0.526 |     0.474 | 
          |-----------|-----------|



 </code></pre>
</div>
</div>
</section>
<section id="data-preprocessing" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="data-preprocessing"><span class="header-section-number">7.4</span> Data preprocessing</h2>
<p>Перетворимо значення <code>deposit</code> до <code>0</code> і <code>1</code>:</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>deposit <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>deposit <span class="sc">==</span> <span class="st">"yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Видалимо <code>duration</code>, адже цей параметр чітко вказує на факт укладання угоди, такі дані називаються leak:</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>duration <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Створимо новий параметр <code>pdays_flag</code>, який вказує чи був контакт з клієнтом раніше:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>pdays_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>pdays <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 17</caption>
<thead>
    <tr><th></th><th scope="col">age</th><th scope="col">job</th><th scope="col">marital</th><th scope="col">education</th><th scope="col">default</th><th scope="col">balance</th><th scope="col">housing</th><th scope="col">loan</th><th scope="col">contact</th><th scope="col">day</th><th scope="col">month</th><th scope="col">campaign</th><th scope="col">pdays</th><th scope="col">previous</th><th scope="col">poutcome</th><th scope="col">deposit</th><th scope="col">pdays_flag</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;ord&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>59</td><td>admin.    </td><td>married</td><td>secondary</td><td>no</td><td>2343</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
    <tr><th scope="row">2</th><td>56</td><td>admin.    </td><td>married</td><td>secondary</td><td>no</td><td>  45</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
    <tr><th scope="row">3</th><td>41</td><td>technician</td><td>married</td><td>secondary</td><td>no</td><td>1270</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
    <tr><th scope="row">4</th><td>55</td><td>services  </td><td>married</td><td>secondary</td><td>no</td><td>2476</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
    <tr><th scope="row">5</th><td>54</td><td>admin.    </td><td>married</td><td>tertiary </td><td>no</td><td> 184</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
    <tr><th scope="row">6</th><td>42</td><td>management</td><td>single </td><td>tertiary </td><td>no</td><td>   0</td><td>yes</td><td>yes</td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td></tr>
</tbody>
</table>
</div>
</div>
<p>Створимо новий параметр <code>poutcome_success</code>, який вказує чи була попередня кампанія з цим клієнтом “успішною для банку”:</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>poutcoume_success <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data<span class="sc">$</span>poutcome <span class="sc">==</span> <span class="st">"success"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="traintest-split" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="traintest-split"><span class="header-section-number">7.5</span> Train/test split</h2>
<p>Задаємо seed для генератора випадкових чисел</p>
<p>Train 65%, test 35%</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>) </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(caret))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>index <span class="ot">=</span> <span class="fu">createDataPartition</span>(data<span class="sc">$</span>deposit, <span class="at">p =</span> <span class="fl">0.65</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">=</span> data[index, ]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">=</span> data[<span class="sc">-</span>index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(train_data<span class="sc">$</span>deposit)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(test_data<span class="sc">$</span>deposit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  7256 

 
          |         0 |         1 | 
          |-----------|-----------|
          |      3816 |      3440 | 
          |     0.526 |     0.474 | 
          |-----------|-----------|



 

 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  3906 

 
          |         0 |         1 | 
          |-----------|-----------|
          |      2057 |      1849 | 
          |     0.527 |     0.473 | 
          |-----------|-----------|



 </code></pre>
</div>
</div>
<hr>
</section>
<section id="decision-trees-with-rpart" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="decision-trees-with-rpart"><span class="header-section-number">7.6</span> Decision trees with <code>rpart()</code></h2>
<p>Для побудови дерев рішень у <code>R</code> є ряд пакетів та алгоритмів. Розглянемо пакет <code>rpart</code>.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("rpart")</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>rpart_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(deposit <span class="sc">~</span> ., train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Виведемо опис моделі:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>rpart_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>n= 7256 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 7256 1809.12900 0.4740904  
   2) poutcome=failure,other,unknown 6563 1605.86300 0.4270913  
     4) contact=unknown 1543  272.24240 0.2287751 *
     5) contact=cellular,telephone 5020 1254.28300 0.4880478  
      10) housing=yes 2139  507.93360 0.3880318 *
      11) housing=no 2881  709.06630 0.5623048  
        22) balance&lt; 105.5 636  150.38990 0.3836478 *
        23) balance&gt;=105.5 2245  532.62540 0.6129176 *
   3) poutcome=success 693   51.47475 0.9191919 *</code></pre>
</div>
</div>
<p>Дуже детальний опис:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rpart_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = deposit ~ ., data = train_data)
  n= 7256 

          CP nsplit rel error    xerror        xstd
1 0.08390285      0 1.0000000 1.0004337 0.001224021
2 0.04385421      1 0.9160972 0.9165627 0.005207633
3 0.02060824      2 0.8722429 0.8731088 0.006530786
4 0.01439973      3 0.8516347 0.8528095 0.007275812
5 0.01000000      4 0.8372350 0.8459897 0.007777416

Variable importance
         poutcome poutcoume_success           contact           housing 
               33                33                17                 8 
          balance               job             pdays             month 
                6                 1                 1                 1 

Node number 1: 7256 observations,    complexity param=0.08390285
  mean=0.4740904, MSE=0.2493287 
  left son=2 (6563 obs) right son=3 (693 obs)
  Primary splits:
      poutcome          splits as  LLRL,      improve=0.08390285, (0 missing)
      poutcoume_success &lt; 0.5   to the left,  improve=0.08390285, (0 missing)
      contact           splits as  RRL,       improve=0.06524266, (0 missing)
      pdays             &lt; 9.5   to the left,  improve=0.04926922, (0 missing)
      previous          &lt; 0.5   to the left,  improve=0.04820004, (0 missing)
  Surrogate splits:
      poutcoume_success &lt; 0.5   to the left,  agree=1.000, adj=1.000, (0 split)
      age               &lt; 91    to the left,  agree=0.905, adj=0.003, (0 split)

Node number 2: 6563 observations,    complexity param=0.04385421
  mean=0.4270913, MSE=0.2446843 
  left son=4 (1543 obs) right son=5 (5020 obs)
  Primary splits:
      contact splits as  RRL,          improve=0.04940515, (0 missing)
      housing splits as  RL,           improve=0.03656129, (0 missing)
      age     &lt; 60.5  to the left,     improve=0.02289822, (0 missing)
      job     splits as  LLLLLRLLRLRL, improve=0.02007437, (0 missing)
      balance &lt; 798   to the left,     improve=0.01917691, (0 missing)
  Surrogate splits:
      campaign &lt; 24.5  to the right, agree=0.766, adj=0.003, (0 split)

Node number 3: 693 observations
  mean=0.9191919, MSE=0.07427813 

Node number 4: 1543 observations
  mean=0.2287751, MSE=0.1764371 

Node number 5: 5020 observations,    complexity param=0.02060824
  mean=0.4880478, MSE=0.2498571 
  left son=10 (2139 obs) right son=11 (2881 obs)
  Primary splits:
      housing splits as  RL,           improve=0.02972452, (0 missing)
      balance &lt; 799.5 to the left,     improve=0.02236410, (0 missing)
      job     splits as  LLLLLRLLRLRL, improve=0.02093907, (0 missing)
      age     &lt; 59.5  to the left,     improve=0.02067340, (0 missing)
      loan    splits as  RL,           improve=0.01407420, (0 missing)
  Surrogate splits:
      job      splits as  LLRRRRRLRRRR, agree=0.630, adj=0.132, (0 split)
      pdays    &lt; 165.5 to the right,    agree=0.623, adj=0.115, (0 split)
      month    splits as  LLLLLRRRRRRR, agree=0.615, adj=0.096, (0 split)
      poutcome splits as  LR-R,         agree=0.604, adj=0.071, (0 split)
      previous &lt; 0.5   to the right,    agree=0.599, adj=0.059, (0 split)

Node number 10: 2139 observations
  mean=0.3880318, MSE=0.2374631 

Node number 11: 2881 observations,    complexity param=0.01439973
  mean=0.5623048, MSE=0.2461181 
  left son=22 (636 obs) right son=23 (2245 obs)
  Primary splits:
      balance &lt; 105.5 to the left,     improve=0.03673982, (0 missing)
      loan    splits as  RL,           improve=0.03447328, (0 missing)
      month   splits as  RRRRRRLLLLLL, improve=0.03024729, (0 missing)
      job     splits as  LLLLLRLLRLRL, improve=0.02005774, (0 missing)
      age     &lt; 60.5  to the left,     improve=0.01886179, (0 missing)
  Surrogate splits:
      default splits as  RL, agree=0.787, adj=0.035, (0 split)

Node number 22: 636 observations
  mean=0.3836478, MSE=0.2364622 

Node number 23: 2245 observations
  mean=0.6129176, MSE=0.2372496 
</code></pre>
</div>
</div>
<p>Візуалізуємо дерево рішень:</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("rattle", "RColorBrewer"))</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(rattle))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(RColorBrewer))</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fancyRpartPlot</span>(rpart_model)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># now you can see how model model works</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-48-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Створимо два дата-фрейм для для запису результатів моделювання на тестовій вибірці. Одразу додамо у набори даних реальні значення результатів маркетингової акції deposit та модельовані значення</p>
<p>Дані тренувальної вибірки будуть використовуватися для визначення оптимальної cutoff лінії, а тестової для порівняння моделей між собою.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>train_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">No =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(train_data)), </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">deposit =</span> train_data<span class="sc">$</span>deposit, </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">RPartPredicted =</span> <span class="fu">predict</span>(rpart_model, train_data))</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">No =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(test_data)),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">deposit =</span> test_data<span class="sc">$</span>deposit, </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">RPartPredicted =</span> <span class="fu">predict</span>(rpart_model, test_data))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 3</caption>
<thead>
    <tr><th></th><th scope="col">No</th><th scope="col">deposit</th><th scope="col">RPartPredicted</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>0.2287751</td></tr>
    <tr><th scope="row">2</th><td>2</td><td>1</td><td>0.2287751</td></tr>
    <tr><th scope="row">4</th><td>3</td><td>1</td><td>0.2287751</td></tr>
    <tr><th scope="row">7</th><td>4</td><td>1</td><td>0.2287751</td></tr>
    <tr><th scope="row">8</th><td>5</td><td>1</td><td>0.2287751</td></tr>
    <tr><th scope="row">9</th><td>6</td><td>1</td><td>0.2287751</td></tr>
</tbody>
</table>
</div>
</div>
<p>Визначимо оптимальну лінію розподілу на 0 і 1 для тренувальної вибірки за допомогою пакету <code>InformationValue</code>:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(InformationValue))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>optCutOff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>deposit, train_results<span class="sc">$</span>RPartPredicted)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>optCutOff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.389191919191919
</div>
</div>
<p>Побудуємо <code>ROC</code>-криву для тестової вибірки:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(test_results<span class="sc">$</span>deposit, test_results<span class="sc">$</span>RPartPredicted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-51-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Сформуємо набір класів <code>0</code> і <code>1</code> для тестового набору даних:</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>RPartPredicted_Class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_results<span class="sc">$</span>RPartPredicted <span class="sc">&gt;</span> optCutOff, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Confusion matrix:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(test_results<span class="sc">$</span>RPartPredicted_Class), </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1504  553
         1  793 1056
                                          
               Accuracy : 0.6554          
                 95% CI : (0.6403, 0.6703)
    No Information Rate : 0.5881          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.3043          
                                          
 Mcnemar's Test P-Value : 7.297e-11       
                                          
            Sensitivity : 0.6563          
            Specificity : 0.6548          
         Pos Pred Value : 0.5711          
         Neg Pred Value : 0.7312          
             Prevalence : 0.4119          
         Detection Rate : 0.2704          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.6555          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Переглянемо збалансовану точність класифіції:</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>BAcc <span class="ot">&lt;-</span> cm<span class="sc">$</span>byClass[[<span class="st">"Balanced Accuracy"</span>]]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>BAcc </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.655537676754586
</div>
</div>
<hr>
</section>
<section id="desicion-trees-with-partykit" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="desicion-trees-with-partykit"><span class="header-section-number">7.7</span> Desicion trees with PartyKit</h2>
<p>Побудуємо дерево рішень за допоомгою пакету <code>partykit</code>:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("partykit")</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(partykit))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_data)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>party_model <span class="ot">&lt;-</span> <span class="fu">ctree</span>(deposit <span class="sc">~</span> ., <span class="at">data =</span> train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 18</caption>
<thead>
    <tr><th></th><th scope="col">age</th><th scope="col">job</th><th scope="col">marital</th><th scope="col">education</th><th scope="col">default</th><th scope="col">balance</th><th scope="col">housing</th><th scope="col">loan</th><th scope="col">contact</th><th scope="col">day</th><th scope="col">month</th><th scope="col">campaign</th><th scope="col">pdays</th><th scope="col">previous</th><th scope="col">poutcome</th><th scope="col">deposit</th><th scope="col">pdays_flag</th><th scope="col">poutcoume_success</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;ord&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">3</th><td>41</td><td>technician </td><td>married</td><td>secondary</td><td>no</td><td>1270</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">5</th><td>54</td><td>admin.     </td><td>married</td><td>tertiary </td><td>no</td><td> 184</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">6</th><td>42</td><td>management </td><td>single </td><td>tertiary </td><td>no</td><td>   0</td><td>yes</td><td>yes</td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">11</th><td>38</td><td>admin.     </td><td>single </td><td>secondary</td><td>no</td><td> 100</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">12</th><td>30</td><td>blue-collar</td><td>married</td><td>secondary</td><td>no</td><td> 309</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">14</th><td>46</td><td>blue-collar</td><td>single </td><td>tertiary </td><td>no</td><td> 460</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
</div>
<p>Виведемо текстовий опис моделі:</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>party_model</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Looks like this model is more complex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Model formula:
deposit ~ age + job + marital + education + default + balance + 
    housing + loan + contact + day + month + campaign + pdays + 
    previous + poutcome + pdays_flag + poutcoume_success

Fitted party:
[1] root
|   [2] poutcome in failure, other, unknown
|   |   [3] contact in cellular, telephone
|   |   |   [4] housing in no
|   |   |   |   [5] loan in no
|   |   |   |   |   [6] campaign &lt;= 3
|   |   |   |   |   |   [7] job in admin., management, retired, student, unemployed
|   |   |   |   |   |   |   [8] day &lt;= 17: 0.733 (n = 715, err = 140.0)
|   |   |   |   |   |   |   [9] day &gt; 17
|   |   |   |   |   |   |   |   [10] job in admin., management, retired, unemployed: 0.583 (n = 434, err = 105.5)
|   |   |   |   |   |   |   |   [11] job in student: 0.843 (n = 51, err = 6.7)
|   |   |   |   |   |   [12] job in blue-collar, entrepreneur, housemaid, self-employed, services, technician, unknown
|   |   |   |   |   |   |   [13] campaign &lt;= 1: 0.612 (n = 415, err = 98.5)
|   |   |   |   |   |   |   [14] campaign &gt; 1
|   |   |   |   |   |   |   |   [15] balance &lt;= 106
|   |   |   |   |   |   |   |   |   [16] age &lt;= 57: 0.234 (n = 94, err = 16.9)
|   |   |   |   |   |   |   |   |   [17] age &gt; 57: 0.700 (n = 10, err = 2.1)
|   |   |   |   |   |   |   |   [18] balance &gt; 106: 0.561 (n = 321, err = 79.1)
|   |   |   |   |   [19] campaign &gt; 3
|   |   |   |   |   |   [20] marital in divorced, single: 0.579 (n = 195, err = 47.5)
|   |   |   |   |   |   [21] marital in married
|   |   |   |   |   |   |   [22] campaign &lt;= 5: 0.474 (n = 171, err = 42.6)
|   |   |   |   |   |   |   [23] campaign &gt; 5: 0.299 (n = 154, err = 32.3)
|   |   |   |   [24] loan in yes: 0.302 (n = 321, err = 67.7)
|   |   |   [25] housing in yes
|   |   |   |   [26] campaign &lt;= 3
|   |   |   |   |   [27] marital in divorced, single: 0.455 (n = 759, err = 188.2)
|   |   |   |   |   [28] marital in married: 0.372 (n = 985, err = 230.0)
|   |   |   |   [29] campaign &gt; 3: 0.301 (n = 395, err = 83.1)
|   |   [30] contact in unknown
|   |   |   [31] month &lt;= sep
|   |   |   |   [32] marital in divorced, single: 0.275 (n = 619, err = 123.3)
|   |   |   |   [33] marital in married: 0.183 (n = 903, err = 134.9)
|   |   |   [34] month &gt; sep: 0.857 (n = 21, err = 2.6)
|   [35] poutcome in success
|   |   [36] contact in cellular: 0.925 (n = 637, err = 44.4)
|   |   [37] contact in telephone, unknown: 0.857 (n = 56, err = 6.9)

Number of inner nodes:    18
Number of terminal nodes: 19</code></pre>
</div>
</div>
<p>Візуалізуємо побудоване дерево рішень:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(party_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Конвернтуємо <code>ctree()</code> до <code>rpart()</code>:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">as.simpleparty</span>(party_model)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(st)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Додамо прогнозовані показники до раніше створених дата-фрейму для збору результатів:</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>train_results<span class="sc">$</span>PartyPredicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(party_model, train_data)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>PartyPredicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(party_model, test_data)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th></th><th scope="col">No</th><th scope="col">deposit</th><th scope="col">RPartPredicted</th><th scope="col">RPartPredicted_Class</th><th scope="col">PartyPredicted</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td></tr>
    <tr><th scope="row">2</th><td>2</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td></tr>
    <tr><th scope="row">4</th><td>3</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td></tr>
    <tr><th scope="row">7</th><td>4</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td></tr>
    <tr><th scope="row">8</th><td>5</td><td>1</td><td>0.2287751</td><td>0</td><td>0.2746365</td></tr>
    <tr><th scope="row">9</th><td>6</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td></tr>
</tbody>
</table>
</div>
</div>
<p>Визначимо оптимальну лінію розділення на класи 0 і 1:</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>optCutOff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>deposit, train_results<span class="sc">$</span>PartyPredicted)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>optCutOff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.474646781789639
</div>
</div>
<p>ROC-крива та AUROC:</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(test_results<span class="sc">$</span>deposit, test_results<span class="sc">$</span>PartyPredicted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Розділимо результати прогнозування на класи:</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>PartyPredicted_Class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_results<span class="sc">$</span>PartyPredicted <span class="sc">&gt;</span> optCutOff, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Confusion matrix:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">factor</span>(test_results<span class="sc">$</span>PartyPredicted_Class), </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1535  522
         1  803 1046
                                          
               Accuracy : 0.6608          
                 95% CI : (0.6457, 0.6756)
    No Information Rate : 0.5986          
    P-Value [Acc &gt; NIR] : 6.520e-16       
                                          
                  Kappa : 0.3144          
                                          
 Mcnemar's Test P-Value : 1.446e-14       
                                          
            Sensitivity : 0.6671          
            Specificity : 0.6565          
         Pos Pred Value : 0.5657          
         Neg Pred Value : 0.7462          
             Prevalence : 0.4014          
         Detection Rate : 0.2678          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.6618          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Оцінимо збалансовану точність класифікації:</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>BAcc <span class="co"># value for previous model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.655537676754586
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>BAcc1 <span class="ot">&lt;-</span> cm<span class="sc">$</span>byClass[[<span class="st">"Balanced Accuracy"</span>]]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>BAcc1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.661817945741171
</div>
</div>
<hr>
</section>
<section id="desision-tree-with-c50" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="desision-tree-with-c50"><span class="header-section-number">7.8</span> Desision Tree with c50</h2>
<p>Скористаємося алгоритмом <code>C50</code> для побудови дерева рішень. Для початку потрібно виіхдний показник перетворити у категоріальний (<code>factor</code>):</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets make anew temporary dataset for modeling with target output as factor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>train_data_tmp <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">deposit =</span> <span class="fu">factor</span>(train_data<span class="sc">$</span>deposit, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>test_data_tmp <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">deposit =</span> <span class="fu">factor</span>(test_data<span class="sc">$</span>deposit, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Побудуємо модель:</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(C50)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>c5_model <span class="ot">&lt;-</span> <span class="fu">C5.0</span>(deposit <span class="sc">~</span> ., <span class="at">data =</span> train_data_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Переглянемо модель:</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(c5_model)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># its hard to check the nodes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
C5.0.formula(formula = deposit ~ ., data = train_data_tmp)


C5.0 [Release 2.07 GPL Edition]     Mon Oct 03 18:54:18 2022
-------------------------------

Class specified by attribute `outcome'

Read 7256 cases (18 attributes) from undefined.data

Decision tree:

poutcoume_success &gt; 0: 1 (693/56)
poutcoume_success &lt;= 0:
:...pdays &gt; 374: 1 (75/10)
    pdays &lt;= 374:
    :...age &gt; 60: 1 (292/66)
        age &lt;= 60:
        :...contact = unknown:
            :...poutcome = success: 0 (0)
            :   poutcome in {failure,other}: 1 (3)
            :   poutcome = unknown:
            :   :...month in [oct-dec]: 1 (20/2)
            :       month in [jan-sep]:
            :       :...month in [jan-apr]: 1 (10/1)
            :           month in [may-sep]:
            :           :...marital = married: 0 (893/157)
            :               marital in {divorced,single}:
            :               :...default = yes:
            :                   :...marital = divorced: 0 (7/2)
            :                   :   marital = single:
            :                   :   :...day &lt;= 16: 1 (6)
            :                   :       day &gt; 16: 0 (7/2)
            :                   default = no:
            :                   :...day &lt;= 29: 0 (564/139)
            :                       day &gt; 29:
            :                       :...campaign &gt; 7: 1 (4)
            :                           campaign &lt;= 7:
            :                           :...campaign &lt;= 1: 1 (5/1)
            :                               campaign &gt; 1: 0 (19/7)
            contact in {cellular,telephone}:
            :...month = dec: 1 (32/3)
                month in [jan-nov]:
                :...housing = yes:
                    :...month = nov:
                    :   :...day &lt;= 16: 1 (23/7)
                    :   :   day &gt; 16: 0 (264/65)
                    :   month in [jan-oct]:
                    :   :...month in [sep-oct]: 1 (47/7)
                    :       month in [jan-aug]:
                    :       :...contact = telephone: 0 (110/17)
                    :           contact = cellular:
                    :           :...marital in {divorced,
                    :               :           married}: 0 (1115/408)
                    :               marital = single:
                    :               :...pdays_flag &gt; 0:
                    :                   :...education in {primary,
                    :                   :   :             unknown}: 0 (13/3)
                    :                   :   education = secondary:
                    :                   :   :...loan = no: 0 (69/19)
                    :                   :   :   loan = yes: 1 (8/2)
                    :                   :   education = tertiary:
                    :                   :   :...poutcome = failure: 1 (55/24)
                    :                   :       poutcome in {other,success,
                    :                   :                    unknown}: 0 (17/3)
                    :                   pdays_flag &lt;= 0:
                    :                   :...job in {entrepreneur,management,
                    :                       :       retired,
                    :                       :       services}: 0 (129/55)
                    :                       job in {housemaid,self-employed,
                    :                       :       student,unemployed,
                    :                       :       unknown}: 1 (35/13)
                    :                       job = admin.:
                    :                       :...campaign &lt;= 2: 1 (42/20)
                    :                       :   campaign &gt; 2:
                    :                       :   :...loan = no: 0 (12)
                    :                       :       loan = yes: 1 (4/1)
                    :                       job = technician: [S1]
                    :                       job = blue-collar:
                    :                       :...loan = yes: 1 (10)
                    :                           loan = no: [S2]
                    housing = no:
                    :...loan = yes:
                        :...month = jan: 0 (20/1)
                        :   month in [feb-nov]:
                        :   :...age &gt; 37: 0 (170/39)
                        :       age &lt;= 37:
                        :       :...job in {admin.,housemaid,management,
                        :           :       retired,self-employed,student,
                        :           :       unknown}: 0 (58/20)
                        :           job = unemployed: 1 (1)
                        :           job = blue-collar:
                        :           :...education in {primary,
                        :           :   :             tertiary}: 0 (3)
                        :           :   education in {secondary,
                        :           :                 unknown}: 1 (20/5)
                        :           job = entrepreneur:
                        :           :...balance &lt;= 935: 0 (5/1)
                        :           :   balance &gt; 935: 1 (2)
                        :           job = services:
                        :           :...day &lt;= 9: 0 (6)
                        :           :   day &gt; 9: 1 (6/1)
                        :           job = technician:
                        :           :...age &lt;= 29: 1 (11/3)
                        :               age &gt; 29: 0 (16/3)
                        loan = no:
                        :...balance &lt;= 105:
                            :...day &lt;= 5:
                            :   :...month in [jan-feb]: 0 (22/8)
                            :   :   month in [mar-nov]: 1 (28/4)
                            :   day &gt; 5:
                            :   :...month in [jan-apr]:
                            :       :...month in [feb-apr]: 1 (42/10)
                            :       :   month = jan:
                            :       :   :...day &lt;= 20: 1 (4)
                            :       :       day &gt; 20: 0 (32/9)
                            :       month in [may-nov]:
                            :       :...month in [may-aug]: 0 (283/72)
                            :           month in [sep-nov]:
                            :           :...day &gt; 21: 1 (11)
                            :               day &lt;= 21:
                            :               :...balance &lt;= 86: 0 (45/16)
                            :                   balance &gt; 86: 1 (3)
                            balance &gt; 105:
                            :...month in [jan-jun]:
                                :...month in [mar-jun]:
                                :   :...pdays &lt;= 293: 1 (470/88)
                                :   :   pdays &gt; 293:
                                :   :   :...marital = divorced: 1 (4)
                                :   :       marital in {married,
                                :   :                   single}: 0 (20/8)
                                :   month in [jan-feb]:
                                :   :...day &gt; 27: 0 (67/17)
                                :       day &lt;= 27:
                                :       :...day &gt; 9: 1 (71/6)
                                :           day &lt;= 9: [S3]
                                month in [jul-nov]:
                                :...pdays_flag &gt; 0:
                                    :...month in [jul-oct]: 1 (101/15)
                                    :   month = nov:
                                    :   :...campaign &gt; 2: 0 (4)
                                    :       campaign &lt;= 2:
                                    :       :...day &lt;= 17: 1 (20/2)
                                    :           day &gt; 17:
                                    :           :...pdays &lt;= 106: 1 (5/1)
                                    :               pdays &gt; 106: 0 (8)
                                    pdays_flag &lt;= 0:
                                    :...age &lt;= 29: 1 (92/14)
                                        age &gt; 29:
                                        :...marital = divorced:
                                            :...balance &gt; 710: 1 (44/9)
                                            :   balance &lt;= 710: [S4]
                                            marital in {married,single}:
                                            :...campaign &lt;= 1: [S5]
                                                campaign &gt; 1:
                                                :...day &lt;= 10:
                                                    :...campaign &gt; 7: 0 (5)
                                                    :   campaign &lt;= 7: [S6]
                                                    day &gt; 10: [S7]

SubTree [S1]

education in {primary,unknown}: 0 (2)
education = tertiary:
:...month in [jan-jul]: 1 (25/9)
:   month = aug: 0 (4)
education = secondary:
:...month = jan: 0 (3)
    month in [feb-aug]:
    :...month in [feb-apr]: 1 (16/3)
        month in [may-aug]: 0 (25/10)

SubTree [S2]

education = unknown: 0 (0)
education = tertiary: 1 (1)
education = primary:
:...age &lt;= 27: 1 (3)
:   age &gt; 27:
:   :...age &lt;= 46: 0 (13/4)
:       age &gt; 46: 1 (2)
education = secondary:
:...age &lt;= 23: 1 (4)
    age &gt; 23:
    :...month in [jan-may]: 0 (24/5)
        month in [jun-aug]:
        :...day &lt;= 14: 0 (6/2)
            day &gt; 14: 1 (6)

SubTree [S3]

education = unknown: 0 (7/2)
education = primary:
:...marital in {divorced,married}: 0 (10/2)
:   marital = single: 1 (3)
education = tertiary:
:...pdays &lt;= 192: 1 (59/24)
:   pdays &gt; 192: 0 (5)
education = secondary:
:...marital = divorced: 0 (3)
    marital = married:
    :...balance &lt;= 1381: 0 (16/4)
    :   balance &gt; 1381: 1 (8/1)
    marital = single:
    :...day &lt;= 7: 0 (27/5)
        day &gt; 7: 1 (7/1)

SubTree [S4]

job in {admin.,self-employed,unemployed}: 1 (9/1)
job in {blue-collar,entrepreneur,housemaid,management,retired,services,student,
:       unknown}: 0 (19/7)
job = technician:
:...age &lt;= 54: 0 (11/2)
    age &gt; 54: 1 (3)

SubTree [S5]

contact = telephone: 1 (16/1)
contact = cellular:
:...education in {primary,unknown}: 0 (28/8)
    education in {secondary,tertiary}: 1 (136/56)

SubTree [S6]

job in {admin.,retired,self-employed,student}: 1 (12/1)
job in {entrepreneur,housemaid,unemployed,unknown}: 0 (7/1)
job = blue-collar:
:...campaign &lt;= 5: 0 (8/1)
:   campaign &gt; 5: 1 (2)
job = services:
:...balance &lt;= 755: 0 (3)
:   balance &gt; 755: 1 (4)
job = technician:
:...contact = cellular: 1 (19/4)
:   contact = telephone: 0 (2)
job = management:
:...contact = telephone: 1 (2)
    contact = cellular:
    :...age &lt;= 45: 1 (20/7)
        age &gt; 45: 0 (7/1)

SubTree [S7]

job in {admin.,housemaid,management,self-employed,services,student,
:       unknown}: 0 (215/68)
job = unemployed: 1 (10/3)
job = blue-collar:
:...marital = married: 0 (40/16)
:   marital = single: 1 (3)
job = entrepreneur:
:...balance &lt;= 1679: 0 (5)
:   balance &gt; 1679: 1 (4/1)
job = retired:
:...contact = telephone: 1 (3)
:   contact = cellular:
:   :...day &lt;= 16: 1 (5)
:       day &gt; 16:
:       :...age &lt;= 53: 1 (2)
:           age &gt; 53: 0 (12/1)
job = technician:
:...education = primary: 0 (0)
    education = unknown: 1 (1)
    education = tertiary:
    :...age &lt;= 39: 0 (21/6)
    :   age &gt; 39: 1 (7/1)
    education = secondary:
    :...age &lt;= 34: 0 (16)
        age &gt; 34:
        :...marital = married: 0 (30/8)
            marital = single:
            :...day &lt;= 21: 1 (8)
                day &gt; 21: 0 (5/1)


Evaluation on training data (7256 cases):

        Decision Tree   
      ----------------  
      Size      Errors  

       124 1709(23.6%)   &lt;&lt;


       (a)   (b)    &lt;-classified as
      ----  ----
      3332   484    (a): class 0
      1225  2215    (b): class 1


    Attribute usage:

    100.00% poutcoume_success
     90.45% pdays
     89.42% age
     85.39% contact
     85.35% month
     63.75% housing
     54.99% marital
     37.22% loan
     30.71% balance
     30.04% day
     22.19% poutcome
     20.70% pdays_flag
     13.91% job
     10.76% campaign
      9.87% education
      8.43% default


Time: 0.1 secs</code></pre>
</div>
</div>
<p>Здійснимо прогноз значень:</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>train_results<span class="sc">$</span>C5Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(c5_model, train_data_tmp)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>C5Predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(c5_model, test_data_tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ROC-крива та AUROC:</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(<span class="fu">as.numeric</span>(test_results<span class="sc">$</span>deposit), <span class="fu">as.numeric</span>(test_results<span class="sc">$</span>C5Predicted))</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># you can see that current algorithm is not very good for this data, partykit is much better</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-71-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Confusion Matrix:</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                             test_results<span class="sc">$</span>C5Predicted, </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1662  395
         1  777 1072
                                          
               Accuracy : 0.6999          
                 95% CI : (0.6853, 0.7143)
    No Information Rate : 0.6244          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.3918          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.7307          
            Specificity : 0.6814          
         Pos Pred Value : 0.5798          
         Neg Pred Value : 0.8080          
             Prevalence : 0.3756          
         Detection Rate : 0.2744          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.7061          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Збалансована точність моделі:</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>BAcc <span class="co"># rpart</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>BAcc1 <span class="co"># partykit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.655537676754586
</div>
<div class="cell-output cell-output-display">
0.661817945741171
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>BAcc2 <span class="ot">&lt;-</span> cm<span class="sc">$</span>byClass[[<span class="st">"Balanced Accuracy"</span>]]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>BAcc2</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co"># but balanced accuracy is the best. So this model better classify both good and bad events</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.706084913609872
</div>
</div>
<hr>
</section>
<section id="randomforest" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="randomforest"><span class="header-section-number">7.9</span> RandomForest</h2>
<p>You can use <code>random forest</code> with default or special training parameters.</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 5</caption>
<thead>
    <tr><th></th><th scope="col">No</th><th scope="col">deposit</th><th scope="col">RPartPredicted</th><th scope="col">PartyPredicted</th><th scope="col">C5Predicted</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">3</th><td>1</td><td>1</td><td>0.2287751</td><td>0.1827243</td><td>0</td></tr>
    <tr><th scope="row">5</th><td>2</td><td>1</td><td>0.2287751</td><td>0.1827243</td><td>0</td></tr>
    <tr><th scope="row">6</th><td>3</td><td>1</td><td>0.2287751</td><td>0.2746365</td><td>0</td></tr>
    <tr><th scope="row">11</th><td>4</td><td>1</td><td>0.2287751</td><td>0.2746365</td><td>0</td></tr>
    <tr><th scope="row">12</th><td>5</td><td>1</td><td>0.2287751</td><td>0.1827243</td><td>0</td></tr>
    <tr><th scope="row">14</th><td>6</td><td>1</td><td>0.2287751</td><td>0.2746365</td><td>0</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 18</caption>
<thead>
    <tr><th></th><th scope="col">age</th><th scope="col">job</th><th scope="col">marital</th><th scope="col">education</th><th scope="col">default</th><th scope="col">balance</th><th scope="col">housing</th><th scope="col">loan</th><th scope="col">contact</th><th scope="col">day</th><th scope="col">month</th><th scope="col">campaign</th><th scope="col">pdays</th><th scope="col">previous</th><th scope="col">poutcome</th><th scope="col">deposit</th><th scope="col">pdays_flag</th><th scope="col">poutcoume_success</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;ord&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">3</th><td>41</td><td>technician </td><td>married</td><td>secondary</td><td>no</td><td>1270</td><td>yes</td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">5</th><td>54</td><td>admin.     </td><td>married</td><td>tertiary </td><td>no</td><td> 184</td><td>no </td><td>no </td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">6</th><td>42</td><td>management </td><td>single </td><td>tertiary </td><td>no</td><td>   0</td><td>yes</td><td>yes</td><td>unknown</td><td>5</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">11</th><td>38</td><td>admin.     </td><td>single </td><td>secondary</td><td>no</td><td> 100</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>1</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">12</th><td>30</td><td>blue-collar</td><td>married</td><td>secondary</td><td>no</td><td> 309</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
    <tr><th scope="row">14</th><td>46</td><td>blue-collar</td><td>single </td><td>tertiary </td><td>no</td><td> 460</td><td>yes</td><td>no </td><td>unknown</td><td>7</td><td>may</td><td>2</td><td>-1</td><td>0</td><td>unknown</td><td>1</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("randomForest")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train_data<span class="sc">$</span>deposit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
   0    1 
3816 3440 </code></pre>
</div>
</div>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(randomForest))</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(deposit <span class="sc">~</span> ., </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data=</span>train_data, </span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ntree=</span><span class="dv">200</span>, </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mtry=</span><span class="dv">2</span>, </span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">importance=</span><span class="cn">TRUE</span>) <span class="co">#Should importance of predictors be assessed?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message in randomForest.default(m, y, ...):
"The response has five or fewer unique values.  Are you sure you want to do regression?"</code></pre>
</div>
</div>
<p><code>ntree</code> - Number of trees to grow. This should not be set to too small a number, to ensure that every input row gets predicted at least a few times.</p>
<p><code>mtry</code> - Number of variables randomly sampled as candidates at each split.</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>rf_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
 randomForest(formula = deposit ~ ., data = train_data, ntree = 200,      mtry = 2, importance = TRUE) 
               Type of random forest: regression
                     Number of trees: 200
No. of variables tried at each split: 2

          Mean of squared residuals: 0.1909128
                    % Var explained: 23.43</code></pre>
</div>
</div>
<p>Можемо провести аналіз важливості параметрів у залежності від критерію <code>зменшення точності</code> або <code>зменшення джині</code>:</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-81-output-1.png" class="img-fluid"></p>
</div>
</div>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked=""><code>MeanDecreaseAccuracy</code>: gives a rough estimate of the loss in prediction performance when that particular variable is omitted from the training set. Caveat: if two variables are somewhat redundant, then omitting one of them may not lead to massive gains in prediction performance, but would make the second variable more important.</p></li>
<li><p><input type="checkbox" disabled="" checked=""><code>MeanDecreaseGini</code>: GINI is a measure of node impurity. Think of it like this, if you use this feature to split the data, how pure will the nodes be? Highest purity means that each node contains only elements of a single class. Assessing the decrease in GINI when that feature is omitted leads to an understanding of how important that feature is to split the data correctly.</p></li>
</ul>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>train_results<span class="sc">$</span>RF <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, train_data)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>RF <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>optCutOff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>deposit, train_results<span class="sc">$</span>RF)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>optCutOff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.426968327910145
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>RF_Class <span class="ot">=</span> <span class="fu">ifelse</span>(test_results<span class="sc">$</span>RF <span class="sc">&gt;</span> optCutOff, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ROC-крива та AUROC:</p>
<div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(<span class="fu">as.numeric</span>(test_results<span class="sc">$</span>deposit), <span class="fu">as.numeric</span>(test_results<span class="sc">$</span>RF))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-85-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced accuracy is much better the before!</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">factor</span>(test_results<span class="sc">$</span>RF_Class), </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1411  646
         1  506 1343
                                          
               Accuracy : 0.7051          
                 95% CI : (0.6905, 0.7193)
    No Information Rate : 0.5092          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.4107          
                                          
 Mcnemar's Test P-Value : 4.216e-05       
                                          
            Sensitivity : 0.6752          
            Specificity : 0.7360          
         Pos Pred Value : 0.7263          
         Neg Pred Value : 0.6860          
             Prevalence : 0.5092          
         Detection Rate : 0.3438          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.7056          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Balanced accuracy is hte best for now</p>
<hr>
</section>
<section id="xgboost" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">7.10</span> xgBoost</h2>
<p>Our next step is testing gradient boosting with <code>xgboost</code> algorithm.</p>
<div class="cell" data-execution_count="86">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(xgboost))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For complex algorithm like <code>random forest</code> or <code>xgboost</code> model training is the most important stage.</p>
<p>XGBoost only works with numeric vectors. Therefore, you need to convert all other forms of data into numeric vectors.</p>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>train_labels <span class="ot">&lt;-</span> train_data<span class="sc">$</span>deposit</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>test_labels <span class="ot">&lt;-</span> test_data<span class="sc">$</span>deposit</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>xgb_train_data <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">model.matrix</span>(deposit<span class="sc">~</span>., <span class="at">data =</span> train_data),</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">label =</span> train_labels)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>xgb_test_data <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> <span class="fu">model.matrix</span>(deposit<span class="sc">~</span>., <span class="at">data =</span> test_data),</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">label =</span> test_labels)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>xgb_test_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>xgb.DMatrix  dim: 3906 x 44  info: label  colnames: yes</code></pre>
</div>
</div>
<p>We will train decision tree model using the following parameters:</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked=""><code>objective = "binary:logistic"</code>: we will train a binary classification model ;</li>
<li><input type="checkbox" disabled="" checked=""><code>max.depth = 2</code>: the trees won’t be deep, because our case is very simple ;</li>
<li><input type="checkbox" disabled="" checked=""><code>nthread = 2</code>: the number of CPU threads we are going to use;</li>
<li><input type="checkbox" disabled="" checked=""><code>nrounds = 2</code>: there will be two passes on the data, the second one will enhance the model by further reducing the difference between ground truth and prediction.</li>
</ul>
<div class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">data =</span> xgb_train_data, </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> train_labels, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max.depth =</span> <span class="dv">2</span>, </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                     <span class="co">#eta = 1, </span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nthread =</span> <span class="dv">2</span>, </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nrounds =</span> <span class="dv">2</span>, </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">objective =</span> <span class="st">"binary:logistic"</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>xgb_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message in xgb.get.DMatrix(data, label, missing, weight, nthread = merged$nthread):
"xgboost: label will be ignored."</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.659975 
[2] train-logloss:0.635883 </code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>##### xgb.Booster
raw: 5.8 Kb 
call:
  xgb.train(params = params, data = dtrain, nrounds = nrounds, 
    watchlist = watchlist, verbose = verbose, print_every_n = print_every_n, 
    early_stopping_rounds = early_stopping_rounds, maximize = maximize, 
    save_period = save_period, save_name = save_name, xgb_model = xgb_model, 
    callbacks = callbacks, max.depth = 2, nthread = 2, objective = "binary:logistic")
params (as set within xgb.train):
  max_depth = "2", nthread = "2", objective = "binary:logistic", validate_parameters = "TRUE"
xgb.attributes:
  niter
callbacks:
  cb.print.evaluation(period = print_every_n)
  cb.evaluation.log()
# of features: 44 
niter: 2
nfeatures : 44 
evaluation_log:
 iter train_logloss
    1     0.6599753
    2     0.6358826</code></pre>
</div>
</div>
<div class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict data</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>train_results<span class="sc">$</span>XGB <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, xgb_train_data)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>XGB <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, xgb_test_data)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 10</caption>
<thead>
    <tr><th></th><th scope="col">No</th><th scope="col">deposit</th><th scope="col">RPartPredicted</th><th scope="col">RPartPredicted_Class</th><th scope="col">PartyPredicted</th><th scope="col">PartyPredicted_Class</th><th scope="col">C5Predicted</th><th scope="col">RF</th><th scope="col">RF_Class</th><th scope="col">XGB</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2377513</td><td>0</td><td>0.3903929</td></tr>
    <tr><th scope="row">2</th><td>2</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2456910</td><td>0</td><td>0.3903929</td></tr>
    <tr><th scope="row">4</th><td>3</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2173557</td><td>0</td><td>0.3903929</td></tr>
    <tr><th scope="row">7</th><td>4</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2370295</td><td>0</td><td>0.3903929</td></tr>
    <tr><th scope="row">8</th><td>5</td><td>1</td><td>0.2287751</td><td>0</td><td>0.2746365</td><td>0</td><td>0</td><td>0.3459498</td><td>0</td><td>0.3903929</td></tr>
    <tr><th scope="row">9</th><td>6</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.1872509</td><td>0</td><td>0.3903929</td></tr>
</tbody>
</table>
</div>
</div>
<p>Optimal cutoff:</p>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>optCutOff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>deposit, train_results<span class="sc">$</span>XGB)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>optCutOff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.473113248348236
</div>
</div>
<div class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate classification class</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>XGB_Class <span class="ot">=</span> <span class="fu">ifelse</span>(test_results<span class="sc">$</span>XGB <span class="sc">&gt;</span> optCutOff, <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="92">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(<span class="fu">as.numeric</span>(test_results<span class="sc">$</span>deposit), <span class="fu">as.numeric</span>(test_results<span class="sc">$</span>XGB))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-93-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced accuracy is not better, random forest wins for now!</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">factor</span>(test_results<span class="sc">$</span>XGB_Class), </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1777  280
         1 1065  784
                                          
               Accuracy : 0.6557          
                 95% CI : (0.6405, 0.6706)
    No Information Rate : 0.7276          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.2942          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.7368          
            Specificity : 0.6253          
         Pos Pred Value : 0.4240          
         Neg Pred Value : 0.8639          
             Prevalence : 0.2724          
         Detection Rate : 0.2007          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.6811          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<hr>
</section>
<section id="lightgbm" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="lightgbm"><span class="header-section-number">7.11</span> lightgbm</h2>
<p>Light gbm is one of most useful package for machine learning. It has one super power: speed of calculations. While you using very big datasets <code>randomForest</code> and <code>xgBoost</code> work slow, but <code>lightgbm</code> works better.</p>
<p>For this algorithm we should convert our data to special matrices too. So, lets install packages for example:</p>
<div class="cell" data-execution_count="94">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">ALERT</span><span class="co"> sometimes you need to unistall Matrix in RSTudio and install it again</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(Matrix))                      </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(lightgbm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Lets use binning technique for data preprocessing</p>
<div class="cell" data-execution_count="95">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(scorecard))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="96">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>vars_list <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>deposit) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>vars_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'age'</li><li>'job'</li><li>'marital'</li><li>'education'</li><li>'default'</li><li>'balance'</li><li>'housing'</li><li>'loan'</li><li>'contact'</li><li>'day'</li><li>'month'</li><li>'campaign'</li><li>'pdays'</li><li>'previous'</li><li>'poutcome'</li><li>'pdays_flag'</li><li>'poutcoume_success'</li></ol>
</div>
</div>
<div class="cell" data-execution_count="97">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>bin_class <span class="ot">&lt;-</span> <span class="fu">woebin</span>(train_data, </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> <span class="st">"deposit"</span>, </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> vars_list, </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">positive =</span> <span class="dv">1</span>, <span class="co"># the value in deposit that indicates event                   </span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">bin_num_limit =</span> <span class="dv">20</span>)</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co"># bin_class - to check bins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] creating woe binning ... </code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>train_woe <span class="ot">&lt;-</span> <span class="fu">woebin_ply</span>(train_data, bin_class)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>test_woe <span class="ot">&lt;-</span> <span class="fu">woebin_ply</span>(test_data, bin_class)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_woe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[INFO] converting into woe values ... 
[INFO] converting into woe values ... </code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.table: 6 × 18</caption>
<thead>
    <tr><th scope="col">deposit</th><th scope="col">age_woe</th><th scope="col">job_woe</th><th scope="col">marital_woe</th><th scope="col">education_woe</th><th scope="col">default_woe</th><th scope="col">balance_woe</th><th scope="col">housing_woe</th><th scope="col">loan_woe</th><th scope="col">contact_woe</th><th scope="col">day_woe</th><th scope="col">month_woe</th><th scope="col">campaign_woe</th><th scope="col">pdays_woe</th><th scope="col">previous_woe</th><th scope="col">poutcome_woe</th><th scope="col">pdays_flag_woe</th><th scope="col">poutcoume_success_woe</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1</td><td>-0.1919797</td><td> 0.18206313</td><td>-0.1591497</td><td>-0.1114005</td><td>0</td><td> 0.34944916</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td> 0.22554244</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>1</td><td>-0.1919797</td><td>-0.02410209</td><td>-0.1591497</td><td> 0.2697353</td><td>0</td><td>-0.34928490</td><td> 0.4042223</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>-0.03160046</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>1</td><td>-0.1919797</td><td> 0.17010635</td><td> 0.2785068</td><td> 0.2697353</td><td>0</td><td>-0.34928490</td><td>-0.4636881</td><td>-0.61989139</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>-0.03160046</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>1</td><td>-0.1919797</td><td>-0.02410209</td><td> 0.2785068</td><td>-0.1114005</td><td>0</td><td>-0.34928490</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td> 0.22554244</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>1</td><td>-0.1919797</td><td>-0.47176755</td><td>-0.1591497</td><td>-0.1114005</td><td>0</td><td>-0.05026394</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>-0.03160046</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>1</td><td>-0.1919797</td><td>-0.47176755</td><td> 0.2785068</td><td> 0.2697353</td><td>0</td><td>-0.05026394</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>-0.03160046</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>vars_list <span class="ot">&lt;-</span> train_woe <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>deposit) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>() </span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>vars_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'age_woe'</li><li>'job_woe'</li><li>'marital_woe'</li><li>'education_woe'</li><li>'default_woe'</li><li>'balance_woe'</li><li>'housing_woe'</li><li>'loan_woe'</li><li>'contact_woe'</li><li>'day_woe'</li><li>'month_woe'</li><li>'campaign_woe'</li><li>'pdays_woe'</li><li>'previous_woe'</li><li>'poutcome_woe'</li><li>'pdays_flag_woe'</li><li>'poutcoume_success_woe'</li></ol>
</div>
</div>
<div class="cell" data-execution_count="100">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_woe <span class="sc">%&gt;%</span> <span class="fu">select</span>(vars_list))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Note: Using an external vector in selections is ambiguous.
i Use `all_of(vars_list)` instead of `vars_list` to silence this message.
i See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
This message is displayed once per session.</code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.table: 6 × 17</caption>
<thead>
    <tr><th scope="col">age_woe</th><th scope="col">job_woe</th><th scope="col">marital_woe</th><th scope="col">education_woe</th><th scope="col">default_woe</th><th scope="col">balance_woe</th><th scope="col">housing_woe</th><th scope="col">loan_woe</th><th scope="col">contact_woe</th><th scope="col">day_woe</th><th scope="col">month_woe</th><th scope="col">campaign_woe</th><th scope="col">pdays_woe</th><th scope="col">previous_woe</th><th scope="col">poutcome_woe</th><th scope="col">pdays_flag_woe</th><th scope="col">poutcoume_success_woe</th></tr>
    <tr><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>-0.1919797</td><td>-0.02410209</td><td>-0.15914969</td><td>-0.1114005</td><td>0</td><td> 0.34944916</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>-0.1919797</td><td>-0.02410209</td><td>-0.15914969</td><td>-0.1114005</td><td>0</td><td>-0.34928490</td><td> 0.4042223</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>-0.1919797</td><td>-0.26465641</td><td>-0.15914969</td><td>-0.1114005</td><td>0</td><td> 0.34944916</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>-0.1919797</td><td> 0.17010635</td><td>-0.15914969</td><td> 0.2697353</td><td>0</td><td> 0.34944916</td><td>-0.4636881</td><td>-0.61989139</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td> 1.2441251</td><td> 0.73838226</td><td> 0.01571154</td><td>-0.1114005</td><td>0</td><td>-0.05026394</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
    <tr><td>-0.1919797</td><td> 0.18206313</td><td>-0.15914969</td><td>-0.1114005</td><td>0</td><td>-0.34928490</td><td>-0.4636881</td><td> 0.08789815</td><td>-1.11036</td><td>-0.2931007</td><td>-0.6621753</td><td>0.2255424</td><td>-0.2605003</td><td>-0.2597224</td><td>-0.2592721</td><td>-0.2597224</td><td>-0.1899974</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>train_sparse <span class="ot">=</span> <span class="fu">Matrix</span>(<span class="fu">as.matrix</span>(train_woe <span class="sc">%&gt;%</span> <span class="fu">select</span>(vars_list)), <span class="at">sparse=</span><span class="cn">TRUE</span>)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>test_sparse <span class="ot">=</span> <span class="fu">Matrix</span>(<span class="fu">as.matrix</span>(test_woe <span class="sc">%&gt;%</span> <span class="fu">select</span>(vars_list)), <span class="at">sparse=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>lgb.train <span class="ot">=</span> <span class="fu">lgb.Dataset</span>(<span class="at">data =</span> train_sparse, <span class="at">label =</span> train_woe<span class="sc">$</span>deposit, <span class="at">free_raw_data =</span> <span class="cn">FALSE</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>lgb.test <span class="ot">=</span> <span class="fu">lgb.Dataset</span>(<span class="at">data =</span> test_sparse, <span class="at">label =</span> test_woe<span class="sc">$</span>deposit, <span class="at">free_raw_data =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>lgb.grid <span class="ot">=</span> <span class="fu">list</span>(<span class="at">objective =</span> <span class="st">"binary"</span>,</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>                <span class="co">#save_binary = T,</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">max_bin =</span> <span class="dv">32</span>,</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">num_leaves =</span> <span class="dv">33</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>lgb.train.cv <span class="ot">=</span> <span class="fu">lgb.train</span>(<span class="at">params =</span> lgb.grid,</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> lgb.train,                         </span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">nrounds =</span> <span class="dv">15</span>,                         </span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">early_stopping_round =</span> <span class="dv">300</span>,</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>                         <span class="co">#categorical_feature = categoricals.vec,</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">valids =</span> <span class="fu">list</span>(<span class="at">test =</span> lgb.test),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">verbose =</span> <span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[LightGBM] [Info] Number of positive: 3440, number of negative: 3816
[LightGBM] [Warning] Auto-choosing row-wise multi-threading, the overhead of testing was 0.020781 seconds.
You can set `force_row_wise=true` to remove the overhead.
And if memory is not enough, you can set `force_col_wise=true`.
[LightGBM] [Info] Total Bins 74
[LightGBM] [Info] Number of data points in the train set: 7256, number of used features: 16
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.474090 -&gt; initscore=-0.103731
[LightGBM] [Info] Start training from score -0.103731
[1] "[1]:  test's auc:0.759236"
[1] "[2]:  test's auc:0.760231"
[1] "[3]:  test's auc:0.763489"
[1] "[4]:  test's auc:0.763607"
[1] "[5]:  test's auc:0.763681"
[1] "[6]:  test's auc:0.763814"
[1] "[7]:  test's auc:0.762936"
[1] "[8]:  test's auc:0.765679"
[1] "[9]:  test's auc:0.766939"
[1] "[10]:  test's auc:0.767712"
[1] "[11]:  test's auc:0.768105"
[1] "[12]:  test's auc:0.768932"
[1] "[13]:  test's auc:0.769262"
[1] "[14]:  test's auc:0.769862"
[1] "[15]:  test's auc:0.770532"</code></pre>
</div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict data</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>train_results<span class="sc">$</span>LGBM <span class="ot">&lt;-</span> <span class="fu">predict</span>(lgb.train.cv, train_sparse)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>LGBM <span class="ot">&lt;-</span> <span class="fu">predict</span>(lgb.train.cv, test_sparse)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 12</caption>
<thead>
    <tr><th></th><th scope="col">No</th><th scope="col">deposit</th><th scope="col">RPartPredicted</th><th scope="col">RPartPredicted_Class</th><th scope="col">PartyPredicted</th><th scope="col">PartyPredicted_Class</th><th scope="col">C5Predicted</th><th scope="col">RF</th><th scope="col">RF_Class</th><th scope="col">XGB</th><th scope="col">XGB_Class</th><th scope="col">LGBM</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2377513</td><td>0</td><td>0.3903929</td><td>0</td><td>0.2076138</td></tr>
    <tr><th scope="row">2</th><td>2</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2456910</td><td>0</td><td>0.3903929</td><td>0</td><td>0.1978679</td></tr>
    <tr><th scope="row">4</th><td>3</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2173557</td><td>0</td><td>0.3903929</td><td>0</td><td>0.2076138</td></tr>
    <tr><th scope="row">7</th><td>4</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.2370295</td><td>0</td><td>0.3903929</td><td>0</td><td>0.2076138</td></tr>
    <tr><th scope="row">8</th><td>5</td><td>1</td><td>0.2287751</td><td>0</td><td>0.2746365</td><td>0</td><td>0</td><td>0.3459498</td><td>0</td><td>0.3903929</td><td>0</td><td>0.2508506</td></tr>
    <tr><th scope="row">9</th><td>6</td><td>1</td><td>0.2287751</td><td>0</td><td>0.1827243</td><td>0</td><td>0</td><td>0.1872509</td><td>0</td><td>0.3903929</td><td>0</td><td>0.1978679</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="106">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimal cutoff:</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>optCutOff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>deposit, train_results<span class="sc">$</span>LGBM)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>optCutOff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.489317324236863
</div>
</div>
<div class="cell" data-execution_count="107">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate classification class</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>test_results<span class="sc">$</span>LGBM_Class <span class="ot">=</span> <span class="fu">ifelse</span>(test_results<span class="sc">$</span>LGBM <span class="sc">&gt;</span> optCutOff, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(<span class="fu">as.numeric</span>(test_results<span class="sc">$</span>deposit), <span class="fu">as.numeric</span>(test_results<span class="sc">$</span>LGBM))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="036-supervised-learning-desicion-trees-classification_files/figure-html/cell-108-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="108">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Balanced accuracy is not better, random forest wins for now!</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(test_results<span class="sc">$</span>deposit), </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">factor</span>(test_results<span class="sc">$</span>LGBM_Class), </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1667  390
         1  741 1108
                                          
               Accuracy : 0.7104          
                 95% CI : (0.6959, 0.7246)
    No Information Rate : 0.6165          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.4136          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.7397          
            Specificity : 0.6923          
         Pos Pred Value : 0.5992          
         Neg Pred Value : 0.8104          
             Prevalence : 0.3835          
         Detection Rate : 0.2837          
   Detection Prevalence : 0.4734          
      Balanced Accuracy : 0.7160          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./035-supervised-learning-logistic-regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Логістична регресія. Класифікація. Титанік</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./037-supervised-learning-neural-network-classification.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Нейронні мережі. Deep Learning. Класифікація. Кредитний скоринг</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, Юрій Клебан</div>
  </div>
</footer>



</body></html>