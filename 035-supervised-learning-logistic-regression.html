<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Математичне моделювання в R - 6&nbsp; Логістична регресія. Класифікація. Титанік</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./036-supervised-learning-desicion-trees-classification.html" rel="next">
<link href="./034-supervised-learning-neutal-networks-regression.html" rel="prev">
<link href="./img/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Логістична регресія. Класифікація. Титанік</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Математичне моделювання в R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/kleban/ml-in-r-book/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Про курс</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-intro.html" class="sidebar-item-text sidebar-link">ТЕМА 1. ВСТУП ДО КУРСУ</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./020-feature-engeneering.html" class="sidebar-item-text sidebar-link">ТЕМА 2. КОНСТРУЮВАННЯ ОЗНАК</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./023-feature-engeneering-woe-binning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Woe Binning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./030-supervised-learning.html" class="sidebar-item-text sidebar-link">ТЕМА 3. НАВЧАННЯ "З УЧИТЕЛЕМ"</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./031-supervised-learning-linear-regression-1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Лінійна регресія. Престиж професій</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./032-supervised-learning-linear-regression-2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Лінійна регресія. Прокат велосипедів</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./033-supervised-learning-desicion-trees-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Дерева рішень. Регресія. Баланс кредитної карти</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./034-supervised-learning-neutal-networks-regression.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Нейронні мережі. Регресія. Вартість житла</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./035-supervised-learning-logistic-regression.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Логістична регресія. Класифікація. Титанік</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./036-supervised-learning-desicion-trees-classification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Дерева рішень. Класифікація. Депозити</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./037-supervised-learning-neural-network-classification.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Нейронні мережі. Deep Learning. Класифікація. Кредитний скоринг</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./040-unsupervised-learning.html" class="sidebar-item-text sidebar-link">ТЕМА 4. НАВЧАННЯ "БЕЗ УЧИТЕЛЯ"</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./041-unsupervised-learning-clustering-kmeans-and-random-forest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Як кластеризація підвищує точність моделей “з учителем” (kmeans + renadomForest)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#dataset-overview" id="toc-dataset-overview" class="nav-link active" data-scroll-target="#dataset-overview"><span class="toc-section-number">6.1</span>  Dataset overview</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing"><span class="toc-section-number">6.2</span>  Data preprocessing</a>
  <ul class="collapse">
  <li><a href="#remove-unused-columns" id="toc-remove-unused-columns" class="nav-link" data-scroll-target="#remove-unused-columns"><span class="toc-section-number">6.2.1</span>  Remove unused columns</a></li>
  <li><a href="#check-missing-data" id="toc-check-missing-data" class="nav-link" data-scroll-target="#check-missing-data"><span class="toc-section-number">6.2.2</span>  Check missing data</a></li>
  <li><a href="#visual-analysis" id="toc-visual-analysis" class="nav-link" data-scroll-target="#visual-analysis"><span class="toc-section-number">6.2.3</span>  Visual analysis</a></li>
  </ul></li>
  <li><a href="#splitting-data" id="toc-splitting-data" class="nav-link" data-scroll-target="#splitting-data"><span class="toc-section-number">6.3</span>  Splitting data</a></li>
  <li><a href="#missing-replacement" id="toc-missing-replacement" class="nav-link" data-scroll-target="#missing-replacement"><span class="toc-section-number">6.4</span>  Missing replacement</a></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building"><span class="toc-section-number">7</span>  Model building</a>
  <ul class="collapse">
  <li><a href="#model-accuracy-check" id="toc-model-accuracy-check" class="nav-link" data-scroll-target="#model-accuracy-check"><span class="toc-section-number">7.1</span>  Model accuracy check</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Логістична регресія. Класифікація. Титанік</span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Курс: “Математичне моделювання в R”</p>
<hr>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("mice")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("Amelia")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("InformationValue")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="dataset-overview" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="dataset-overview"><span class="header-section-number">6.1</span> Dataset overview</h2>
<p>У даному навчальному матеріалі використано класичний приклад даних з інформацією про пасажирів корабля Титанік.</p>
<p>Source: https://github.com/Geoyi/Cleaning-Titanic-Data</p>
<p><strong>Dataset description:</strong></p>
<p>You are provided hourly rental data spanning two years. For this competition, the training set is comprised of the first 19 days of each month, while the test set is the 20th to the end of the month. You must predict the total count of bikes rented during each hour covered by the test set, using only information available prior to the rental period.</p>
<p><strong>Data Fields:</strong></p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Definition</th>
<th>Key</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>survival</td>
<td>Survival (<strong>TARGET</strong>)</td>
<td>0 = No, 1 = Yes</td>
</tr>
<tr class="even">
<td>pclass</td>
<td>Ticket class</td>
<td>1 = 1st, 2 = 2nd, 3 = 3rd</td>
</tr>
<tr class="odd">
<td>sex</td>
<td>Sex</td>
<td></td>
</tr>
<tr class="even">
<td>Age</td>
<td>Age in years</td>
<td></td>
</tr>
<tr class="odd">
<td>sibsp</td>
<td># of siblings / spouses aboard the Titanic</td>
<td></td>
</tr>
<tr class="even">
<td>parch</td>
<td># of parents / children aboard the Titanic</td>
<td></td>
</tr>
<tr class="odd">
<td>ticket</td>
<td>Ticket number</td>
<td></td>
</tr>
<tr class="even">
<td>fare</td>
<td>Passenger fare</td>
<td></td>
</tr>
<tr class="odd">
<td>cabin</td>
<td>Cabin number</td>
<td></td>
</tr>
<tr class="even">
<td>embarked</td>
<td>Port of Embarkation</td>
<td>C = Cherbourg, Q = Queenstown, S = Southampton</td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read local</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>titanic_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/Geoyi/Cleaning-Titanic-Data/master/titanic_original.csv"</span>, <span class="at">na.strings =</span> <span class="fu">c</span>(<span class="st">""</span>)) <span class="co"># empty strings is missing data and wiil be replaced with NA</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 14</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">name</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">ticket</th><th scope="col">fare</th><th scope="col">cabin</th><th scope="col">embarked</th><th scope="col">boat</th><th scope="col">body</th><th scope="col">home.dest</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>Allen, Miss. Elisabeth Walton                  </td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>24160 </td><td>211.3375</td><td>B5     </td><td>S</td><td>2 </td><td> NA</td><td>St Louis, MO                   </td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>Allison, Master. Hudson Trevor                 </td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>113781</td><td>151.5500</td><td>C22 C26</td><td>S</td><td>11</td><td> NA</td><td>Montreal, PQ / Chesterville, ON</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>Allison, Miss. Helen Loraine                   </td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>113781</td><td>151.5500</td><td>C22 C26</td><td>S</td><td>NA</td><td> NA</td><td>Montreal, PQ / Chesterville, ON</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>Allison, Mr. Hudson Joshua Creighton           </td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>113781</td><td>151.5500</td><td>C22 C26</td><td>S</td><td>NA</td><td>135</td><td>Montreal, PQ / Chesterville, ON</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>Allison, Mrs. Hudson J C (Bessie Waldo Daniels)</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>113781</td><td>151.5500</td><td>C22 C26</td><td>S</td><td>NA</td><td> NA</td><td>Montreal, PQ / Chesterville, ON</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>Anderson, Mr. Harry                            </td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td>19952 </td><td> 26.5500</td><td>E12    </td><td>S</td><td>3 </td><td> NA</td><td>New York, NY                   </td></tr>
</tbody>
</table>
</div>
</div>
<p>Переглянемо структуру даних:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(titanic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1310 obs. of  14 variables:
 $ pclass   : int  1 1 1 1 1 1 1 1 1 1 ...
 $ survived : int  1 1 0 0 0 1 1 0 1 0 ...
 $ name     : chr  "Allen, Miss. Elisabeth Walton" "Allison, Master. Hudson Trevor" "Allison, Miss. Helen Loraine" "Allison, Mr. Hudson Joshua Creighton" ...
 $ sex      : chr  "female" "male" "female" "male" ...
 $ age      : num  29 0.917 2 30 25 ...
 $ sibsp    : int  0 1 1 1 1 0 1 0 2 0 ...
 $ parch    : int  0 2 2 2 2 0 0 0 0 0 ...
 $ ticket   : chr  "24160" "113781" "113781" "113781" ...
 $ fare     : num  211 152 152 152 152 ...
 $ cabin    : chr  "B5" "C22 C26" "C22 C26" "C22 C26" ...
 $ embarked : chr  "S" "S" "S" "S" ...
 $ boat     : chr  "2" "11" NA NA ...
 $ body     : int  NA NA NA 135 NA NA NA NA NA 22 ...
 $ home.dest: chr  "St Louis, MO" "Montreal, PQ / Chesterville, ON" "Montreal, PQ / Chesterville, ON" "Montreal, PQ / Chesterville, ON" ...</code></pre>
</div>
</div>
<p>Значення показників вибірки:</p>
<ul>
<li><em>survival</em> – “клас виживання” (0 = No; 1 = Yes)</li>
<li><em>pclass</em> – клас пасажирів (1 = 1st; 2 = 2nd; 3 = 3rd)</li>
<li><del><em>name</em></del> – ім’я</li>
<li><em>sex</em> - стать</li>
<li><em>age</em> - вік</li>
<li><em>sibsp</em> – кількість членів сім’ї на борту (братів, сестер, подружжя)</li>
<li><em>parch</em> – кількість дітей або батьків на борту</li>
<li><del><em>ticket</em></del> – номер квитка</li>
<li><em>fare</em> – вартість</li>
<li><em>cabin</em> – номер(и)</li>
<li><em>embarked</em> – порт посадки на судно (C = Cherbourg; Q = Queenstown; S = Southampton)</li>
<li><del><em>boat</em></del> – борт на якому відпливав під час порятунку (якщо врятований)</li>
<li><del><em>body</em></del> – ідентифікаційни номер тіла</li>
<li><del><em>home.dest</em></del> – місце доставки пасажира</li>
</ul>
<p>Детальніше: http://campus.lakeforest.edu/frank/FILES/MLFfiles/Bio150/Titanic/TitanicMETA.pdf.</p>
<p>Закреслені поля надалі будуть видалені з датасету для моделювання.</p>
<hr>
</section>
<section id="data-preprocessing" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="data-preprocessing"><span class="header-section-number">6.2</span> Data preprocessing</h2>
<section id="remove-unused-columns" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="remove-unused-columns"><span class="header-section-number">6.2.1</span> Remove unused columns</h3>
<p>Lets remove columns: - [x] <code>name</code> - just string - [x] <code>ticket</code> - it can be useful to analyze numbers and check if - [x] <code>boat</code> - if boat is not missing - survived, we cannot use it - [x] <code>body</code> - if body is not missing - not survived, cant use it - [x] <code>home.dest</code> - just text</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(dplyr)) <span class="co"># filter()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>titanic_data <span class="ot">&lt;-</span> titanic_data <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"name"</span>, <span class="st">"ticket"</span>, <span class="st">"boat"</span>, <span class="st">"body"</span>, <span class="st">"home.dest"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">cabin</th><th scope="col">embarked</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>211.3375</td><td>B5     </td><td>S</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td> 26.5500</td><td>E12    </td><td>S</td></tr>
</tbody>
</table>
</div>
</div>
<hr>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(titanic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>     pclass         survived         sex                 age         
 Min.   :1.000   Min.   :0.000   Length:1310        Min.   : 0.1667  
 1st Qu.:2.000   1st Qu.:0.000   Class :character   1st Qu.:21.0000  
 Median :3.000   Median :0.000   Mode  :character   Median :28.0000  
 Mean   :2.295   Mean   :0.382                      Mean   :29.8811  
 3rd Qu.:3.000   3rd Qu.:1.000                      3rd Qu.:39.0000  
 Max.   :3.000   Max.   :1.000                      Max.   :80.0000  
 NA's   :1       NA's   :1                          NA's   :264      
     sibsp            parch            fare            cabin          
 Min.   :0.0000   Min.   :0.000   Min.   :  0.000   Length:1310       
 1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:  7.896   Class :character  
 Median :0.0000   Median :0.000   Median : 14.454   Mode  :character  
 Mean   :0.4989   Mean   :0.385   Mean   : 33.295                     
 3rd Qu.:1.0000   3rd Qu.:0.000   3rd Qu.: 31.275                     
 Max.   :8.0000   Max.   :9.000   Max.   :512.329                     
 NA's   :1        NA's   :1       NA's   :2                           
   embarked        
 Length:1310       
 Class :character  
 Mode  :character  
                   
                   
                   
                   </code></pre>
</div>
</div>
<hr>
</section>
<section id="check-missing-data" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="check-missing-data"><span class="header-section-number">6.2.2</span> Check missing data</h3>
<p>Для оцінки кількості пропусків побудуємо матрицю та мапу:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(mice))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(titanic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'mice'


The following object is masked from 'package:stats':

    filter


The following objects are masked from 'package:base':

    cbind, rbind

</code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A matrix: 8 × 10 of type dbl</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">age</th><th scope="col">cabin</th><th scope="col"></th></tr>
</thead>
<tbody>
    <tr><th scope="row">270</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>  1</td><td>   1</td><td>   0</td></tr>
    <tr><th scope="row">773</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>  1</td><td>   0</td><td>   1</td></tr>
    <tr><th scope="row">23</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>  0</td><td>   1</td><td>   1</td></tr>
    <tr><th scope="row">240</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>  0</td><td>   0</td><td>   2</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>  1</td><td>   1</td><td>   1</td></tr>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>  1</td><td>   0</td><td>   2</td></tr>
    <tr><th scope="row">1</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>  0</td><td>   0</td><td>   9</td></tr>
    <tr><th scope="row"></th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>2</td><td>3</td><td>264</td><td>1015</td><td>1289</td></tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-7-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(Amelia))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">missmap</span>(titanic_data, <span class="at">main =</span> <span class="st">'Missing data map'</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'yellow'</span>, <span class="st">'black'</span>), <span class="at">legend =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp

## 
## Amelia II: Multiple Imputation
## (Version 1.8.0, built: 2021-05-26)
## Copyright (C) 2005-2022 James Honaker, Gary King and Matthew Blackwell
## Refer to http://gking.harvard.edu/amelia/ for more information
## 
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-8-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>One more way to check where missing data is present with <code>saplly()</code>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(titanic_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class="dl-inline"><dt>pclass</dt><dd>1</dd><dt>survived</dt><dd>1</dd><dt>sex</dt><dd>1</dd><dt>age</dt><dd>264</dd><dt>sibsp</dt><dd>1</dd><dt>parch</dt><dd>1</dd><dt>fare</dt><dd>2</dd><dt>cabin</dt><dd>1015</dd><dt>embarked</dt><dd>3</dd></dl>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets check where survived is NA, target should be finite</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>titanic_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(survived))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># looks like its wrong line in data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 1 × 9</caption>
<thead>
    <tr><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">cabin</th><th scope="col">embarked</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets remove this row</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>titanic_data <span class="ot">&lt;-</span> titanic_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(survived))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(titanic_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class="dl-inline"><dt>pclass</dt><dd>0</dd><dt>survived</dt><dd>0</dd><dt>sex</dt><dd>0</dd><dt>age</dt><dd>263</dd><dt>sibsp</dt><dd>0</dd><dt>parch</dt><dd>0</dd><dt>fare</dt><dd>1</dd><dt>cabin</dt><dd>1014</dd><dt>embarked</dt><dd>2</dd></dl>
</div>
</div>
<div class="alert alert-danger">
We will replace all missing data on the next stages for: <code>fare</code>, <code>cabin</code>, <code>age</code>, <code>embarked</code>.
</div>
</section>
<section id="visual-analysis" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="visual-analysis"><span class="header-section-number">6.2.3</span> Visual analysis</h3>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># for plots</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels) <span class="co"># for CrossTable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Survived</strong></p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(titanic_data<span class="sc">$</span>survived)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(survived)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(survived))) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  1309 

 
          |         0 |         1 | 
          |-----------|-----------|
          |       809 |       500 | 
          |     0.618 |     0.382 | 
          |-----------|-----------|



 </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Крос-таблиця survived vs pclass</strong></p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(titanic_data<span class="sc">$</span>survived, titanic_data<span class="sc">$</span>pclass)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(pclass)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(pclass)))<span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
| Chi-square contribution |
|           N / Row Total |
|           N / Col Total |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  1309 

 
                      | titanic_data$pclass 
titanic_data$survived |         1 |         2 |         3 | Row Total | 
----------------------|-----------|-----------|-----------|-----------|
                    0 |       123 |       158 |       528 |       809 | 
                      |    29.411 |     1.017 |    18.411 |           | 
                      |     0.152 |     0.195 |     0.653 |     0.618 | 
                      |     0.381 |     0.570 |     0.745 |           | 
                      |     0.094 |     0.121 |     0.403 |           | 
----------------------|-----------|-----------|-----------|-----------|
                    1 |       200 |       119 |       181 |       500 | 
                      |    47.587 |     1.645 |    29.788 |           | 
                      |     0.400 |     0.238 |     0.362 |     0.382 | 
                      |     0.619 |     0.430 |     0.255 |           | 
                      |     0.153 |     0.091 |     0.138 |           | 
----------------------|-----------|-----------|-----------|-----------|
         Column Total |       323 |       277 |       709 |      1309 | 
                      |     0.247 |     0.212 |     0.542 |           | 
----------------------|-----------|-----------|-----------|-----------|

 </code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>sex</strong></p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(<span class="at">x =</span> sex)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(sex))) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Age</strong>*</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(age)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">25</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)  <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
"Removed 263 rows containing non-finite values (stat_bin)."</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>fare</strong></p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(fare)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">fill =</span> <span class="st">'blue'</span>, <span class="at">color=</span><span class="st">'black'</span>)<span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
"Removed 1 rows containing non-finite values (stat_bin)."</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-17-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>sibsp</strong></p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(sibsp)) <span class="sc">+</span> <span class="fu">geom_bar</span>()<span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><strong>parch</strong></p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(parch)) <span class="sc">+</span> <span class="fu">geom_bar</span>()<span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(titanic_data, <span class="fu">aes</span>(embarked)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(embarked)))<span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># it looks like S the most popular value in embarked, so it could be good idea to replace 1 missing with S</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="splitting-data" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="splitting-data"><span class="header-section-number">6.3</span> Splitting data</h2>
<p>Lest split out dataset for test and train</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># seed</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caTools)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">sample.split</span>(titanic_data<span class="sc">$</span>survived, <span class="at">SplitRatio =</span> <span class="fl">0.7</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> <span class="fu">subset</span>(titanic_data, split <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>titanic_test <span class="ot">&lt;-</span> <span class="fu">subset</span>(titanic_data, split <span class="sc">==</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(titanic_train<span class="sc">$</span>survived)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">CrossTable</span>(titanic_test<span class="sc">$</span>survived) <span class="co"># its splitted by the same proportions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  916 

 
          |         0 |         1 | 
          |-----------|-----------|
          |       566 |       350 | 
          |     0.618 |     0.382 | 
          |-----------|-----------|



 

 
   Cell Contents
|-------------------------|
|                       N |
|         N / Table Total |
|-------------------------|

 
Total Observations in Table:  393 

 
          |         0 |         1 | 
          |-----------|-----------|
          |       243 |       150 | 
          |     0.618 |     0.382 | 
          |-----------|-----------|



 </code></pre>
</div>
</div>
<hr>
</section>
<section id="missing-replacement" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="missing-replacement"><span class="header-section-number">6.4</span> Missing replacement</h2>
<p>Missing data replacement should have base points for each parameter.</p>
<p>So, we will fix data for replacement from train and implement it to both train and test.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">cabin</th><th scope="col">embarked</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;chr&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>211.3375</td><td>B5     </td><td>S</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>151.5500</td><td>C22 C26</td><td>S</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td> 26.5500</td><td>E12    </td><td>S</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check missing</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(titanic_train, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(titanic_test, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class="dl-inline"><dt>pclass</dt><dd>0</dd><dt>survived</dt><dd>0</dd><dt>sex</dt><dd>0</dd><dt>age</dt><dd>182</dd><dt>sibsp</dt><dd>0</dd><dt>parch</dt><dd>0</dd><dt>fare</dt><dd>1</dd><dt>cabin</dt><dd>703</dd><dt>embarked</dt><dd>1</dd></dl>
</div>
<div class="cell-output cell-output-display">
<style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class="dl-inline"><dt>pclass</dt><dd>0</dd><dt>survived</dt><dd>0</dd><dt>sex</dt><dd>0</dd><dt>age</dt><dd>81</dd><dt>sibsp</dt><dd>0</dd><dt>parch</dt><dd>0</dd><dt>fare</dt><dd>0</dd><dt>cabin</dt><dd>311</dd><dt>embarked</dt><dd>1</dd></dl>
</div>
</div>
<p>Створюємо dummy-змінну, що буде вказути на наявність запису про каюту у пасажира <code>1/0</code>:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hascabin =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(cabin), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>cabin) <span class="co"># remove cabin column</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>titanic_test <span class="ot">&lt;-</span> titanic_test <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hascabin =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(cabin), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>cabin) <span class="co"># remove cabin column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Заповнюємо дані пропусків вартості квитка <code>fare</code>. Замінюємо <code>NA</code> на середнє значення вартості квитка:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>avg_fare <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(titanic_data<span class="sc">$</span>fare, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">4</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>avg_fare</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lets study new function from tidyr replace NA</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fare =</span> <span class="fu">replace_na</span>(fare, avg_fare))</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># there are no missing in test$fare</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_train<span class="sc">$</span>fare)) <span class="co"># check for missing</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_test<span class="sc">$</span>fare))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
33.2955
</div>
<div class="cell-output cell-output-display">
FALSE
</div>
<div class="cell-output cell-output-display">
FALSE
</div>
</div>
<p>Заповнюємо пропуски для порту посадки (<code>embarked</code>). Варіантом для заміни оберемо найпопулярнішйи варінт значення, той який зустрічається частіше за інші. Скористаємося показником <code>МОДА</code>. З попереднього аналізу відомо, що таким показником є <code>S</code>. Проте варто написати універсальну функцію, що буде сама відбирати значення:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>getmode <span class="ot">&lt;-</span> <span class="cf">function</span>(v) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  uniqv <span class="ot">&lt;-</span> <span class="fu">unique</span>(v) <span class="co"># select all unique values</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  uniqv[<span class="fu">which.max</span>(<span class="fu">tabulate</span>(<span class="fu">match</span>(v, uniqv)))] <span class="co"># select value that included most times</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the moda</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>embarked_moda <span class="ot">&lt;-</span> <span class="fu">getmode</span>(titanic_data<span class="sc">$</span>embarked)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>embarked_moda <span class="co"># its `S`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
'S'
</div>
</div>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">embarked =</span> <span class="fu">replace_na</span>(embarked, embarked_moda))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>titanic_test <span class="ot">&lt;-</span> titanic_test <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">embarked =</span> <span class="fu">replace_na</span>(embarked, embarked_moda))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_train<span class="sc">$</span>embarked)) <span class="co"># check for missing</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_test<span class="sc">$</span>embarked))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
FALSE
</div>
<div class="cell-output cell-output-display">
FALSE
</div>
</div>
<p>Для заміни пропусків по віку (age) використаємо показник “Клас пасажира” (pclass). Обчислимо середній вік пасажирів кожного класу і замінимо пропуски з урахуванням цієї інформації. Тобто для усіх пасажирів 1-го класу замінимо пропуски середнім по пасажирах середнього класу і т.д.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets build boxplot for average age in each class</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>age_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(titanic_train, <span class="fu">aes</span>(pclass, age)) </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>age_plot <span class="ot">&lt;-</span> age_plot <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">group =</span> pclass, <span class="at">fill =</span> <span class="fu">factor</span>(pclass), <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="co"># alpha == opacity of chart elements</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>age_plot <span class="ot">&lt;-</span> age_plot <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="dv">0</span>), <span class="fu">max</span>(<span class="dv">80</span>), <span class="at">by =</span> <span class="dv">2</span>)) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>age_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
"Removed 182 rows containing non-finite values (stat_boxplot)."</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-29-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Середні значення віку для кожного класу пасажирів становлять:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>pclass_ages <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(pclass) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">floor</span>(<span class="fu">mean</span>(age, <span class="at">na.rm =</span>T)))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>pclass_ages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A tibble: 3 × 2</caption>
<thead>
    <tr><th scope="col">pclass</th><th scope="col">mean_age</th></tr>
    <tr><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><td>1</td><td>38</td></tr>
    <tr><td>2</td><td>29</td></tr>
    <tr><td>3</td><td>24</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>titanic_train <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(age), pclass_ages<span class="sc">$</span>mean_age[pclass], age))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>           </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_train<span class="sc">$</span>age)) <span class="co"># check for missing</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
FALSE
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>211.3375</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td> 26.5500</td><td>S</td><td>1</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>titanic_test <span class="ot">&lt;-</span> titanic_test <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(age), pclass_ages<span class="sc">$</span>mean_age[pclass], age))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(titanic_test<span class="sc">$</span>age)) <span class="co"># check for missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
FALSE
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(titanic_train) <span class="co"># OK, no missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> /\     /\
{  `---'  }
{  O   O  }
==&gt;  V &lt;==  No need for mice. This data set is completely observed.
 \  \|/  /
  `-----'
</code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A matrix: 2 × 10 of type dbl</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th><th scope="col"></th></tr>
</thead>
<tbody>
    <tr><th scope="row">916</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td></tr>
    <tr><th scope="row"></th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-33-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">md.pattern</span>(titanic_test) <span class="co"># OK, no missing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> /\     /\
{  `---'  }
{  O   O  }
==&gt;  V &lt;==  No need for mice. This data set is completely observed.
 \  \|/  /
  `-----'
</code></pre>
</div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A matrix: 2 × 10 of type dbl</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th><th scope="col"></th></tr>
</thead>
<tbody>
    <tr><th scope="row">393</th><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td></tr>
    <tr><th scope="row"></th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-34-output-3.png" class="img-fluid"></p>
</div>
</div>
<hr>
</section>
<section id="model-building" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Model building</h1>
<p>Перед побудовою моделі визначимо категоріальні змінні як фактори (factor), щоб під час моделювання для них було сформовано dummy-змінні.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th></tr>
    <tr><th></th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;chr&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>211.3375</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td> 26.5500</td><td>S</td><td>1</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for train</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>pclass <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_train<span class="sc">$</span>pclass, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>survived <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_train<span class="sc">$</span>survived, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>hascabin<span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_train<span class="sc">$</span>hascabin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>embarked <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_train<span class="sc">$</span>embarked, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'S'</span>, <span class="st">'C'</span>, <span class="st">'Q'</span>))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>titanic_train<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_train<span class="sc">$</span>sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'female'</span>, <span class="st">'male'</span>))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>1</td><td>female</td><td>29.0000</td><td>0</td><td>0</td><td>211.3375</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>1</td><td>male  </td><td> 0.9167</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">3</th><td>1</td><td>0</td><td>female</td><td> 2.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">4</th><td>1</td><td>0</td><td>male  </td><td>30.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">5</th><td>1</td><td>0</td><td>female</td><td>25.0000</td><td>1</td><td>2</td><td>151.5500</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>1</td><td>male  </td><td>48.0000</td><td>0</td><td>0</td><td> 26.5500</td><td>S</td><td>1</td></tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use the same levels for factors in test_set</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># different ordering data in </span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="sc">$</span>pclass <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_test<span class="sc">$</span>pclass, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="sc">$</span>survived <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_test<span class="sc">$</span>survived, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="sc">$</span>hascabin<span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_test<span class="sc">$</span>hascabin, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="sc">$</span>embarked <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_test<span class="sc">$</span>embarked, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'S'</span>, <span class="st">'C'</span>, <span class="st">'Q'</span>))</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>titanic_test<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(titanic_test<span class="sc">$</span>sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">'female'</span>, <span class="st">'male'</span>))</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(titanic_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 9</caption>
<thead>
    <tr><th></th><th scope="col">pclass</th><th scope="col">survived</th><th scope="col">sex</th><th scope="col">age</th><th scope="col">sibsp</th><th scope="col">parch</th><th scope="col">fare</th><th scope="col">embarked</th><th scope="col">hascabin</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;int&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">7</th><td>1</td><td>1</td><td>female</td><td>63</td><td>1</td><td>0</td><td> 77.9583</td><td>S</td><td>1</td></tr>
    <tr><th scope="row">11</th><td>1</td><td>0</td><td>male  </td><td>47</td><td>1</td><td>0</td><td>227.5250</td><td>C</td><td>1</td></tr>
    <tr><th scope="row">12</th><td>1</td><td>1</td><td>female</td><td>18</td><td>1</td><td>0</td><td>227.5250</td><td>C</td><td>1</td></tr>
    <tr><th scope="row">13</th><td>1</td><td>1</td><td>female</td><td>24</td><td>0</td><td>0</td><td> 69.3000</td><td>C</td><td>1</td></tr>
    <tr><th scope="row">17</th><td>1</td><td>0</td><td>male  </td><td>24</td><td>0</td><td>1</td><td>247.5208</td><td>C</td><td>1</td></tr>
    <tr><th scope="row">20</th><td>1</td><td>0</td><td>male  </td><td>36</td><td>0</td><td>0</td><td> 75.2417</td><td>C</td><td>1</td></tr>
</tbody>
</table>
</div>
</div>
<p>Для побудови логістичної регресії використовується функція <code>glm()</code>. Формула <code>survived ~ .</code> означає, що у модель будуть відібрані усі параметри із вибірки, а survived буде використано як вихідну змінну. <code>family = binomial(link = "logit")</code> вказує на використання логістиної регресії.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>def_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">formula =</span> survived <span class="sc">~</span> ., <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>), <span class="at">data =</span> titanic_train)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(def_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
glm(formula = survived ~ ., family = binomial(link = "logit"), 
    data = titanic_train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.5558  -0.6169  -0.4128   0.5801   2.6250  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.748e+00  5.167e-01   5.318 1.05e-07 ***
pclass2     -2.653e-01  3.772e-01  -0.703 0.481831    
pclass3     -1.397e+00  3.907e-01  -3.574 0.000351 ***
sexmale     -2.753e+00  1.999e-01 -13.771  &lt; 2e-16 ***
age         -3.423e-02  7.987e-03  -4.285 1.83e-05 ***
sibsp       -3.144e-01  1.111e-01  -2.829 0.004672 ** 
parch       -7.658e-02  1.196e-01  -0.640 0.521911    
fare         4.771e-05  2.313e-03   0.021 0.983541    
embarkedC    6.002e-01  2.336e-01   2.569 0.010193 *  
embarkedQ   -1.329e-01  3.185e-01  -0.417 0.676547    
hascabin1    1.008e+00  3.247e-01   3.104 0.001912 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1218.4  on 915  degrees of freedom
Residual deviance:  805.4  on 905  degrees of freedom
AIC: 827.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Параметри з _***_ вказують на значимість показника у моделі. Здійснимо прогноз по тренувальній вибірці:</p>
<p>And test build model with an other package <code>caret</code> explained before in train/test/validation splitting paragraph.</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("e1071")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(e1071) # required by caret</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(caret))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this is wrapper function for training different models</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>caret_glm <span class="ot">=</span> <span class="fu">train</span>(survived <span class="sc">~</span> ., <span class="co"># formula</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> titanic_train, <span class="co"># data for model training     </span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">'glm'</span>, <span class="co"># model building algorithm, glm</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                    ) <span class="co"># data preprocessing techniques, normalization and scaling</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(caret_glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice
</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
NULL

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.5558  -0.6169  -0.4128   0.5801   2.6250  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  2.748e+00  5.167e-01   5.318 1.05e-07 ***
pclass2     -2.653e-01  3.772e-01  -0.703 0.481831    
pclass3     -1.397e+00  3.907e-01  -3.574 0.000351 ***
sexmale     -2.753e+00  1.999e-01 -13.771  &lt; 2e-16 ***
age         -3.423e-02  7.987e-03  -4.285 1.83e-05 ***
sibsp       -3.144e-01  1.111e-01  -2.829 0.004672 ** 
parch       -7.658e-02  1.196e-01  -0.640 0.521911    
fare         4.771e-05  2.313e-03   0.021 0.983541    
embarkedC    6.002e-01  2.336e-01   2.569 0.010193 *  
embarkedQ   -1.329e-01  3.185e-01  -0.417 0.676547    
hascabin1    1.008e+00  3.247e-01   3.104 0.001912 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1218.4  on 915  degrees of freedom
Residual deviance:  805.4  on 905  degrees of freedom
AIC: 827.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>You can see that we got the same variables significansy in both models, but coefficients are different. Lets check what model building algorithm is better.</p>
</blockquote>
<p>To compare our modeling resutls for train lets create special data frames:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>train_check <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(survived) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predicted_def =</span> <span class="fu">predict</span>(def_glm, <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">newdata =</span> titanic_train), <span class="co"># predicted by default glm function</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">predicted_caret =</span> <span class="fu">predict</span>(caret_glm, <span class="at">type =</span> <span class="st">'prob'</span>, <span class="at">newdata =</span> titanic_train)[, <span class="dv">2</span>]) <span class="co"># predicted by caret train algorithm</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_check)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 3</caption>
<thead>
    <tr><th></th><th scope="col">survived</th><th scope="col">predicted_def</th><th scope="col">predicted_caret</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">1</th><td>1</td><td>0.9412193</td><td>0.9412193</td></tr>
    <tr><th scope="row">2</th><td>1</td><td>0.6250488</td><td>0.6250488</td></tr>
    <tr><th scope="row">3</th><td>0</td><td>0.9618407</td><td>0.9618407</td></tr>
    <tr><th scope="row">4</th><td>0</td><td>0.3812235</td><td>0.3812235</td></tr>
    <tr><th scope="row">5</th><td>0</td><td>0.9198190</td><td>0.9198190</td></tr>
    <tr><th scope="row">6</th><td>1</td><td>0.3455040</td><td>0.3455040</td></tr>
</tbody>
</table>
</div>
</div>
<p>As you see for logistic regression results are the same, so we can use default algorithm. But <code>train()</code> method is very powerfull with desicion trees, boosting, random forest, neural network and other complex algorithms.</p>
<hr>
<section id="model-accuracy-check" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="model-accuracy-check"><span class="header-section-number">7.1</span> Model accuracy check</h2>
<p>Lets create new datasets for train and test results storing. We will use them</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>train_results <span class="ot">&lt;-</span> titanic_train <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(survived) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(def_glm, <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">newdata =</span> titanic_train),</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">residuals =</span> <span class="fu">residuals</span>(def_glm, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> titanic_test <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(survived) <span class="sc">%&gt;%</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">predict</span>(def_glm, <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">newdata =</span> titanic_test))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 2</caption>
<thead>
    <tr><th></th><th scope="col">survived</th><th scope="col">predicted</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">7</th><td>1</td><td>0.7839711</td></tr>
    <tr><th scope="row">11</th><td>0</td><td>0.4233024</td></tr>
    <tr><th scope="row">12</th><td>1</td><td>0.9688239</td></tr>
    <tr><th scope="row">13</th><td>1</td><td>0.9717471</td></tr>
    <tr><th scope="row">17</th><td>0</td><td>0.6718810</td></tr>
    <tr><th scope="row">20</th><td>0</td><td>0.5925107</td></tr>
</tbody>
</table>
</div>
</div>
<p>The next stage is converting out predicted probabilities into event classes 1/0. By default you can do this using next condition <code>predicted == 1 if prob &gt;= 0.5 and 0 if prob &lt; 0.5</code>.</p>
<p>In this case <code>0.5</code> is cut-off line or classification splitter. So, lets do this for both train and test.</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>train_results <span class="ot">&lt;-</span> train_results <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">survived_05 =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(predicted <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="dv">1</span> , <span class="dv">0</span>)))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test_results <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">survived_05 =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(predicted <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="dv">1</span> , <span class="dv">0</span>)))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(test_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<table class="dataframe table table-sm table-striped">
<caption>A data.frame: 6 × 3</caption>
<thead>
    <tr><th></th><th scope="col">survived</th><th scope="col">predicted</th><th scope="col">survived_05</th></tr>
    <tr><th></th><th scope="col">&lt;fct&gt;</th><th scope="col">&lt;dbl&gt;</th><th scope="col">&lt;fct&gt;</th></tr>
</thead>
<tbody>
    <tr><th scope="row">7</th><td>1</td><td>0.7839711</td><td>1</td></tr>
    <tr><th scope="row">11</th><td>0</td><td>0.4233024</td><td>0</td></tr>
    <tr><th scope="row">12</th><td>1</td><td>0.9688239</td><td>1</td></tr>
    <tr><th scope="row">13</th><td>1</td><td>0.9717471</td><td>1</td></tr>
    <tr><th scope="row">17</th><td>0</td><td>0.6718810</td><td>1</td></tr>
    <tr><th scope="row">20</th><td>0</td><td>0.5925107</td><td>1</td></tr>
</tbody>
</table>
</div>
</div>
<p>Для демонстрації переглянемо графік реальних та прогнозованих/модельованих значень survived.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>plot_train_data <span class="ot">&lt;-</span> train_results[<span class="dv">0</span><span class="sc">:</span><span class="dv">80</span>,]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_train_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plot_train_data)), <span class="at">y =</span> <span class="fu">as.numeric</span>(survived)<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plot_train_data)), <span class="at">yend =</span> predicted), <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> residuals), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted), <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
"`guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; = "none")` instead."</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-44-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_test_data <span class="ot">&lt;-</span> test_results[<span class="dv">0</span><span class="sc">:</span><span class="dv">80</span>,]</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_test_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plot_test_data)), <span class="at">y =</span> <span class="fu">as.numeric</span>(survived)<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(plot_test_data)), <span class="at">yend =</span> predicted), <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Увага, для тестової вибірки є зміни, за точку відліку враховується вихідна змінна</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span>  <span class="fu">as.numeric</span>(survived)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted), <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">0.5</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Your code contains a unicode char which cannot be displayed in your
current locale and R will silently convert it to an escaped form when the
R kernel executes this code. This can lead to subtle errors if you use
such chars to do comparisons. For more information, please see
https://github.com/IRkernel/repr/wiki/Problems-with-unicode-on-windowsWarning message:
"`guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; = "none")` instead."</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-45-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Побудуємо confusion matrix для тренувальної вибірки:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Train CM:"</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train_results<span class="sc">$</span>survived, train_results<span class="sc">$</span>survived_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Train CM:"</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>   
      0   1
  0 488  78
  1 104 246</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Test CM:"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(test_results<span class="sc">$</span>survived, test_results<span class="sc">$</span>survived_05)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test CM:"</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>   
      0   1
  0 206  37
  1  46 104</code></pre>
</div>
</div>
<p>Більш детальну статистику по <code>confusion matrix</code> можна отримати скориставшись методом <code>confusionMatrix()</code> з пакету <code>caret</code>.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># train</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(train_results<span class="sc">$</span>survived, train_results<span class="sc">$</span>survived_05, <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 488  78
         1 104 246
                                         
               Accuracy : 0.8013         
                 95% CI : (0.774, 0.8267)
    No Information Rate : 0.6463         
    P-Value [Acc &gt; NIR] : &lt; 2e-16        
                                         
                  Kappa : 0.5732         
                                         
 Mcnemar's Test P-Value : 0.06386        
                                         
            Sensitivity : 0.7593         
            Specificity : 0.8243         
         Pos Pred Value : 0.7029         
         Neg Pred Value : 0.8622         
             Prevalence : 0.3537         
         Detection Rate : 0.2686         
   Detection Prevalence : 0.3821         
      Balanced Accuracy : 0.7918         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(test_results<span class="sc">$</span>survived, test_results<span class="sc">$</span>survived_05, <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 206  37
         1  46 104
                                          
               Accuracy : 0.7888          
                 95% CI : (0.7451, 0.8281)
    No Information Rate : 0.6412          
    P-Value [Acc &gt; NIR] : 1.522e-10       
                                          
                  Kappa : 0.5474          
                                          
 Mcnemar's Test P-Value : 0.3799          
                                          
            Sensitivity : 0.7376          
            Specificity : 0.8175          
         Pos Pred Value : 0.6933          
         Neg Pred Value : 0.8477          
             Prevalence : 0.3588          
         Detection Rate : 0.2646          
   Detection Prevalence : 0.3817          
      Balanced Accuracy : 0.7775          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>One of most often qustions is “What cutoff line should be selected?”. You can have 2 answers:</p>
<ul class="task-list">
<li><p><input type="checkbox" disabled="" checked="">You can select optimal cutoff using best classification criteria: while you best classify both 1 and 0 events</p></li>
<li><p><input type="checkbox" disabled="" checked="">You can select cutoff than help solve your business tasks, for, example, you need to select only 20% most risky clients, so, set your cutoff to 0.8. Or you need concrete count of clients, for example, 1000 and it can be at 0.94 line sometimes if you have big database.</p></li>
</ul>
<p>Lets try to find optimal cutoff with <code>InformationValue</code> package and special method:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(InformationValue))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>opt_cutoff <span class="ot">&lt;-</span> <span class="fu">optimalCutoff</span>(train_results<span class="sc">$</span>survived, train_results<span class="sc">$</span>predicted)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>opt_cutoff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'InformationValue'


The following objects are masked from 'package:caret':

    confusionMatrix, precision, sensitivity, specificity

</code></pre>
</div>
<div class="cell-output cell-output-display">
0.556674085642972
</div>
</div>
<p>Lest compare confusion matrix for previous 0.5 cutoff and current <code>opt_cutoff</code></p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cutoff = 0.5</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(test_results<span class="sc">$</span>survived, test_results<span class="sc">$</span>survived_05, <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 206  37
         1  46 104
                                          
               Accuracy : 0.7888          
                 95% CI : (0.7451, 0.8281)
    No Information Rate : 0.6412          
    P-Value [Acc &gt; NIR] : 1.522e-10       
                                          
                  Kappa : 0.5474          
                                          
 Mcnemar's Test P-Value : 0.3799          
                                          
            Sensitivity : 0.7376          
            Specificity : 0.8175          
         Pos Pred Value : 0.6933          
         Neg Pred Value : 0.8477          
             Prevalence : 0.3588          
         Detection Rate : 0.2646          
   Detection Prevalence : 0.3817          
      Balanced Accuracy : 0.7775          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># opt_cutoff</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> test_results <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">survived_opt =</span> <span class="fu">ifelse</span>(predicted <span class="sc">&gt;=</span> opt_cutoff, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="co"># calculate optima cutoff</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(test_results<span class="sc">$</span>survived, <span class="fu">factor</span>(test_results<span class="sc">$</span>survived_opt), <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 215  28
         1  53  97
                                          
               Accuracy : 0.7939          
                 95% CI : (0.7505, 0.8328)
    No Information Rate : 0.6819          
    P-Value [Acc &gt; NIR] : 5.041e-07       
                                          
                  Kappa : 0.5489          
                                          
 Mcnemar's Test P-Value : 0.007661        
                                          
            Sensitivity : 0.7760          
            Specificity : 0.8022          
         Pos Pred Value : 0.6467          
         Neg Pred Value : 0.8848          
             Prevalence : 0.3181          
         Detection Rate : 0.2468          
   Detection Prevalence : 0.3817          
      Balanced Accuracy : 0.7891          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p><code>Accuracy : 0.7888</code> -&gt; <code>Accuracy : 0.7939</code> increased</p>
<p><code>Balanced Accuracy : 0.7775</code> -&gt; <code>Balanced Accuracy : 0.7891</code> inreased</p>
<p>In this case if you need classificate more clients as <code>survived</code> decrease cutoff, for less <code>survived</code> increase it.</p>
<p>And the last one characteristics we will use is ROC-curve:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for train</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(train_results<span class="sc">$</span>survived, train_results<span class="sc">$</span>predicted) <span class="co"># from InformationValue package</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>auroc <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">AUROC</span>(train_results<span class="sc">$</span>survived, train_results<span class="sc">$</span>predicted), <span class="dv">4</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>auroc</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>gini <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>auroc <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>gini</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co">#if ROC is fully filled and AUROC close to 1 on train, its very big possibility that our model is overfitted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.8573
</div>
<div class="cell-output cell-output-display">
0.7146
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-53-output-3.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for test</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotROC</span>(test_results<span class="sc">$</span>survived, test_results<span class="sc">$</span>predicted) <span class="co"># from InformationValue package</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>auroc <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">AUROC</span>(test_results<span class="sc">$</span>survived, test_results<span class="sc">$</span>predicted), <span class="dv">4</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>auroc</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>gini <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>auroc <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>gini</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">#if ROC is fully filled and AUROC close to 1 on test, its very big possibility that you test sample contains</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
0.8142
</div>
<div class="cell-output cell-output-display">
0.6284
</div>
<div class="cell-output cell-output-display">
<p><img src="035-supervised-learning-logistic-regression_files/figure-html/cell-54-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>You should made your conclusions about test set, because test results shows how model predicting events on data it not know before. Test data is very close to prediction data but did not have target variable, so you can check accuracy on prediction set after some time cheking you experiment on real-world situation.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./034-supervised-learning-neutal-networks-regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Нейронні мережі. Регресія. Вартість житла</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./036-supervised-learning-desicion-trees-classification.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Дерева рішень. Класифікація. Депозити</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2022, Юрій Клебан</div>
  </div>
</footer>



</body></html>